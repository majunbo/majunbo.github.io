
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>匍匐鲲鹏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="学习基于华为云鲲鹏云服务的网站系统">
<meta property="og:type" content="website">
<meta property="og:title" content="匍匐鲲鹏">
<meta property="og:url" content="https://majunbo.top/index.html">
<meta property="og:site_name" content="匍匐鲲鹏">
<meta property="og:description" content="学习基于华为云鲲鹏云服务的网站系统">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="鲲鹏小哪吒">
<meta property="article:tag" content="majunbo，华为云，鲲鹏云服务，majunbo.top，majunbo.github.io">
<meta property="article:tag" content="linux，technology">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="匍匐鲲鹏" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
<link rel="stylesheet" href="/css/style.css">

  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 4.2.0"></head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">匍匐鲲鹏</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">纸上得来终觉浅，绝知此事要躬行</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="majunbo.top">
        </form>
      </div>
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main">
  
    <article id="post-kunpeng09-nginx-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20200513/kunpeng09-nginx-install/" class="article-date">
  <time datetime="2020-05-13T15:10:20.000Z" itemprop="datePublished">2020-05-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20200513/kunpeng09-nginx-install/">鲲鹏服务器实验九：编译nginx</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>安装一台鲲鹏服务器(CentOS\EulerOS)、或者任何X86服务器均可，需要有GCC环境。</p>
<h2 id="一、准备环境"><a href="#一、准备环境" class="headerlink" title="一、准备环境"></a>一、准备环境</h2><p>1、下载nginx软件源代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@web opt]<span class="comment"># wget http://nginx.org/download/nginx-1.16.1.tar.gz</span></span><br><span class="line">[root@web opt]<span class="comment"># tar -zxvf nginx-1.16.1.tar.gz</span></span><br></pre></td></tr></table></figure>
<p>2、准备第三方库：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc gcc-c++ make unzip pcre pcre-devel zlib zlib-devel libxml2 libxml2-devel  readline readline-devel ncurses ncurses-devel perl-devel perl-ExtUtils-Embed openssl-devel -y</span><br></pre></td></tr></table></figure>
<p>3、创建nginx用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd nginx</span><br><span class="line">useradd nginx -g nginx -s &#x2F;sbin&#x2F;nologin -M</span><br></pre></td></tr></table></figure>

<h2 id="二、编译代码"><a href="#二、编译代码" class="headerlink" title="二、编译代码"></a>二、编译代码</h2><p>1、<strong>编译</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#推荐参数</span></span><br><span class="line">$ ./configure --user=nginx --group=nginx --prefix=/usr/<span class="built_in">local</span>/nginx --http-log-path=/var/<span class="built_in">log</span>/nginx/access.log --error-log-path=/var/<span class="built_in">log</span>/nginx/error.log --lock-path=/var/lock/nginx.lock --pid-path=/var/run/nginx.pid --with-pcre-jit --with-http_ssl_module --with-http_v2_module --with-http_sub_module --with-stream --with-stream_ssl_module</span><br><span class="line"></span><br><span class="line"><span class="comment">#或者：</span></span><br><span class="line">[root@web nginx-1.16.1]<span class="comment"># ./configure</span></span><br><span class="line">....</span><br><span class="line">Configuration summary</span><br><span class="line">  + using system PCRE library</span><br><span class="line">  + OpenSSL library is not used</span><br><span class="line">  + using system zlib library</span><br><span class="line"></span><br><span class="line">  nginx path prefix: <span class="string">"/usr/local/nginx"</span></span><br><span class="line">  nginx binary file: <span class="string">"/usr/local/nginx/sbin/nginx"</span></span><br><span class="line">  nginx modules path: <span class="string">"/usr/local/nginx/modules"</span></span><br><span class="line">  nginx configuration prefix: <span class="string">"/usr/local/nginx/conf"</span></span><br><span class="line">  nginx configuration file: <span class="string">"/usr/local/nginx/conf/nginx.conf"</span></span><br><span class="line">  nginx pid file: <span class="string">"/usr/local/nginx/logs/nginx.pid"</span></span><br><span class="line">  nginx error <span class="built_in">log</span> file: <span class="string">"/usr/local/nginx/logs/error.log"</span></span><br><span class="line">  nginx http access <span class="built_in">log</span> file: <span class="string">"/usr/local/nginx/logs/access.log"</span></span><br><span class="line">  nginx http client request body temporary files: <span class="string">"client_body_temp"</span></span><br><span class="line">  nginx http proxy temporary files: <span class="string">"proxy_temp"</span></span><br><span class="line">  nginx http fastcgi temporary files: <span class="string">"fastcgi_temp"</span></span><br><span class="line">  nginx http uwsgi temporary files: <span class="string">"uwsgi_temp"</span></span><br><span class="line">  nginx http scgi temporary files: <span class="string">"scgi_temp"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后执行安装：</span></span><br><span class="line">[root@web nginx-1.16.1]<span class="comment"># make &amp;&amp; make install</span></span><br><span class="line">or</span><br><span class="line">[root@web nginx-1.16.1]<span class="comment"># make -j24 &amp;&amp; make install</span></span><br></pre></td></tr></table></figure>

<p>ps:<br>EulerOS2.8 configure编译出错：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">checking <span class="keyword">for</span> getaddrinfo() ... found</span><br><span class="line">checking <span class="keyword">for</span> PCRE library ... not found</span><br><span class="line">checking <span class="keyword">for</span> PCRE library <span class="keyword">in</span> /usr/<span class="built_in">local</span>/ ... not found</span><br><span class="line">checking <span class="keyword">for</span> PCRE library <span class="keyword">in</span> /usr/include/pcre/ ... not found</span><br><span class="line">checking <span class="keyword">for</span> PCRE library <span class="keyword">in</span> /usr/pkg/ ... not found</span><br><span class="line">checking <span class="keyword">for</span> PCRE library <span class="keyword">in</span> /opt/<span class="built_in">local</span>/ ... not found</span><br><span class="line">./configure: error: the HTTP rewrite module requires the PCRE library.</span><br><span class="line">You can either <span class="built_in">disable</span> the module by using --without-http_rewrite_module</span><br><span class="line">option, or install the PCRE library into the system, or build the PCRE library</span><br><span class="line">statically from the <span class="built_in">source</span> with nginx by using --with-pcre=&lt;path&gt; option.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这就能证明华为官网的帮助是有bug的：</span></span><br><span class="line">https://www.huaweicloud.com/kunpeng/software/nginx.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解决办法：</span></span><br><span class="line">[root@web yum.repos.d]<span class="comment"># pwd</span></span><br><span class="line">/etc/yum.repos.d</span><br><span class="line">[root@web yum.repos.d]<span class="comment"># vim EulerOS.repo</span></span><br><span class="line">[base]</span><br><span class="line">name=EulerOS-2.0SP8 base</span><br><span class="line">baseurl=http://developer.huawei.com/ict/site-euleros/euleros/repo/yum/2.8/os/aarch64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=http://developer.huawei.com/ict/site-euleros/euleros/repo/yum/2.8/os/RPM-GPG-KEY-EulerOS</span><br><span class="line"></span><br><span class="line">查询已经成功配置的repo源，可以使用以下命令：</span><br><span class="line">yum repolist</span><br><span class="line">如果您要更新所有的包和它们的依赖，在root权限下使用命令如下：</span><br><span class="line">yum update</span><br><span class="line">安装pcre-devel\openssl解决问题</span><br><span class="line">yum -y install pcre-devel</span><br><span class="line">yum -y install openssl openssl-devel</span><br></pre></td></tr></table></figure>

<p>2、修改文件权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改目录权限</span></span><br><span class="line">[root@web nginx-1.16.1]<span class="comment"># chown -R nginx:nginx /usr/local/nginx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建软链接</span></span><br><span class="line">[root@web nginx-1.16.1]<span class="comment"># ln -s /usr/local/nginx/sbin/nginx /usr/bin/nginx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看版本：</span></span><br><span class="line">[root@web sbin]<span class="comment"># cd /usr/local/nginx/</span></span><br><span class="line">[root@web nginx]<span class="comment"># ./sbin/nginx -V</span></span><br><span class="line">nginx version: nginx/1.16.1</span><br><span class="line">built by gcc 7.3.0 (GCC) </span><br><span class="line">configure arguments:</span><br><span class="line"></span><br><span class="line"><span class="comment">#或者：</span></span><br><span class="line">[root@web ~]<span class="comment"># nginx -v</span></span><br><span class="line">nginx version: nginx/1.16.1</span><br></pre></td></tr></table></figure>

<h2 id="三、配置开机启动"><a href="#三、配置开机启动" class="headerlink" title="三、配置开机启动"></a>三、配置开机启动</h2><h3 id="3-1编写systemctl启动文件（适合于CentOS-RHEL7-推荐）："><a href="#3-1编写systemctl启动文件（适合于CentOS-RHEL7-推荐）：" class="headerlink" title="3.1编写systemctl启动文件（适合于CentOS\RHEL7 推荐）："></a>3.1编写systemctl启动文件（适合于CentOS\RHEL7 推荐）：</h3><p>可修改nginx.conf配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改PID文件位置，如果上面配置了 --pid-path=/var/run/nginx.pid</span></span><br><span class="line">[root@web opt]<span class="comment"># vim /usr/local/nginx/conf/nginx.conf</span></span><br><span class="line">change this:</span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line">to this:</span><br><span class="line">pid        /var/run/nginx.pid;</span><br></pre></td></tr></table></figure>

<p>开机自启动<br>vim /usr/lib/systemd/system/nginx.service<br>增加下面代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=The NGINX HTTP and reverse proxy server</span><br><span class="line">After=network-online.target remote-fs.target nss-lookup.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/var/run/nginx.pid</span><br><span class="line">ExecStartPre=/usr/<span class="built_in">local</span>/nginx/sbin/nginx -t -c /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br><span class="line">ExecStart=/usr/<span class="built_in">local</span>/nginx/sbin/nginx -c /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br><span class="line">ExecReload=/bin/<span class="built_in">kill</span> -s HUP <span class="variable">$MAINPID</span></span><br><span class="line">ExecStop=/bin/<span class="built_in">kill</span> -s QUIT <span class="variable">$MAINPID</span></span><br><span class="line">PrivateTmp=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>配置自动启动：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@web system]<span class="comment"># chkconfig nginx on</span></span><br><span class="line">Note: Forwarding request to <span class="string">'systemctl enable nginx.service'</span>.</span><br><span class="line">or</span><br><span class="line">[root@web ~]<span class="comment"># systemctl enable nginx.service</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动系统：</span></span><br><span class="line">[root@web system]<span class="comment"># systemctl start nginx</span></span><br><span class="line"><span class="comment"># 查看状态：</span></span><br><span class="line">[root@web system]<span class="comment"># systemctl status  nginx</span></span><br><span class="line">● nginx.service - The NGINX HTTP and reverse proxy server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/nginx.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Wed 2020-04-01 10:39:36 CST; 3min 32s ago</span><br><span class="line"> Main PID: 25498 (nginx)</span><br><span class="line">    Tasks: 2 (<span class="built_in">limit</span>: 5632)</span><br><span class="line">   Memory: 1.5M</span><br><span class="line">   CGroup: /system.slice/nginx.service</span><br><span class="line">           ├─25498 nginx: master process /usr/<span class="built_in">local</span>/nginx/sbin/nginx -c /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br><span class="line">           └─25499 nginx: worker process</span><br><span class="line"></span><br><span class="line">Apr 01 10:39:36 euler systemd[1]: Starting The NGINX HTTP and reverse proxy server...</span><br><span class="line">Apr 01 10:39:36 euler nginx[25496]: nginx: the configuration file /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf syntax is ok</span><br><span class="line">Apr 01 10:39:36 euler nginx[25496]: nginx: configuration file /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf <span class="built_in">test</span> is successful</span><br><span class="line">Apr 01 10:39:36 euler systemd[1]: nginx.service: Failed to parse PID from file /var/run/nginx.pid: Invalid argument</span><br><span class="line">Apr 01 10:39:36 euler systemd[1]: Started The NGINX HTTP and reverse proxy server.</span><br></pre></td></tr></table></figure>
<p>上面有错误：euler systemd[1]: nginx.service: Failed to parse PID from file /var/run/nginx.pid: Invalid argument</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个文件夹和override.conf文件</span></span><br><span class="line">[root@web ~]<span class="comment"># cd  /usr/lib/systemd/system</span></span><br><span class="line">[root@web system]<span class="comment"># mkdir nginx.service.d</span></span><br><span class="line">[root@web system]<span class="comment"># printf "[Service]\nExecStartPost=/bin/sleep 0.1\n" &gt; /usr/lib/systemd/system/nginx.service.d/override.conf</span></span><br><span class="line">[root@web system]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2自己编写启动文件（可兼容CentOS-RHEL6）"><a href="#3-2自己编写启动文件（可兼容CentOS-RHEL6）" class="headerlink" title="3.2自己编写启动文件（可兼容CentOS\RHEL6）"></a>3.2自己编写启动文件（可兼容CentOS\RHEL6）</h3><p>可修改nginx.conf配置文件vim /usr/local/nginx/conf/nginx.conf：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改PID文件位置，如果上面配置了 --pid-path=/var/run/nginx.pid</span></span><br><span class="line">[root@web nginx]<span class="comment"># mkdir /usr/local/nginx/logs</span></span><br><span class="line">[root@web opt]<span class="comment"># vim /usr/local/nginx/conf/nginx.conf</span></span><br><span class="line">change this:</span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line">to this:</span><br><span class="line">pid        /usr/<span class="built_in">local</span>/nginx/logs/nginx.pid;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>下列/etc/init.d/nginx代码使用systemctl启动时必须配置/usr/local/nginx/logs/文件夹，否则centos7可能会有问题：</p>
</blockquote>
<p>vim /etc/init.d/nginx </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># nginx - this script starts and stops the nginx daemon</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># chkconfig:   - 85 15</span></span><br><span class="line"><span class="comment"># description:  NGINX is an HTTP(S) server, HTTP(S) reverse \</span></span><br><span class="line"><span class="comment">#               proxy and IMAP/POP3 proxy server</span></span><br><span class="line"><span class="comment"># processname: nginx</span></span><br><span class="line"><span class="comment"># config:      /usr/local/nginx/conf/nginx.conf</span></span><br><span class="line"><span class="comment"># config:      /etc/sysconfig/nginx</span></span><br><span class="line"><span class="comment"># pidfile:     /usr/local/nginx/logs/nginx.pid</span></span><br><span class="line"><span class="comment"># Source function library.</span></span><br><span class="line">. /etc/rc.d/init.d/<span class="built_in">functions</span></span><br><span class="line"><span class="comment"># Source networking configuration.</span></span><br><span class="line">. /etc/sysconfig/network</span><br><span class="line"><span class="comment"># Check that networking is up.</span></span><br><span class="line">[ <span class="string">"<span class="variable">$NETWORKING</span>"</span> = <span class="string">"no"</span> ] &amp;&amp; <span class="built_in">exit</span> 0</span><br><span class="line">nginx=<span class="string">"/usr/local/nginx/sbin/nginx"</span></span><br><span class="line">prog=$(basename <span class="variable">$nginx</span>)</span><br><span class="line">NGINX_CONF_FILE=<span class="string">"/usr/local/nginx/conf/nginx.conf"</span></span><br><span class="line">[ -f /etc/sysconfig/nginx ] &amp;&amp; . /etc/sysconfig/nginx</span><br><span class="line">lockfile=/var/lock/subsys/nginx</span><br><span class="line"><span class="function"><span class="title">make_dirs</span></span>() &#123;</span><br><span class="line">   <span class="comment"># make required directories</span></span><br><span class="line">   user=`<span class="variable">$nginx</span> -V 2&gt;&amp;1 | grep <span class="string">"configure arguments:"</span> | sed <span class="string">'s/[^*]*--user=\([^ ]*\).*/\1/g'</span> -`</span><br><span class="line">   <span class="keyword">if</span> [ -z <span class="string">"`grep <span class="variable">$user</span> /etc/passwd`"</span> ]; <span class="keyword">then</span></span><br><span class="line">       useradd -M -s /bin/nologin <span class="variable">$user</span></span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">   options=`<span class="variable">$nginx</span> -V 2&gt;&amp;1 | grep <span class="string">'configure arguments:'</span>`</span><br><span class="line">   <span class="keyword">for</span> opt <span class="keyword">in</span> <span class="variable">$options</span>; <span class="keyword">do</span></span><br><span class="line">       <span class="keyword">if</span> [ `<span class="built_in">echo</span> <span class="variable">$opt</span> | grep <span class="string">'.*-temp-path'</span>` ]; <span class="keyword">then</span></span><br><span class="line">           value=`<span class="built_in">echo</span> <span class="variable">$opt</span> | cut -d <span class="string">"="</span> -f 2`</span><br><span class="line">           <span class="keyword">if</span> [ ! -d <span class="string">"<span class="variable">$value</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">               <span class="comment"># echo "creating" $value</span></span><br><span class="line">               mkdir -p <span class="variable">$value</span> &amp;&amp; chown -R <span class="variable">$user</span> <span class="variable">$value</span></span><br><span class="line">           <span class="keyword">fi</span></span><br><span class="line">       <span class="keyword">fi</span></span><br><span class="line">   <span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">start</span></span>() &#123;</span><br><span class="line">    [ -x <span class="variable">$nginx</span> ] || <span class="built_in">exit</span> 5</span><br><span class="line">    [ -f <span class="variable">$NGINX_CONF_FILE</span> ] || <span class="built_in">exit</span> 6</span><br><span class="line">    make_dirs</span><br><span class="line">    <span class="built_in">echo</span> -n $<span class="string">"Starting <span class="variable">$prog</span>: "</span></span><br><span class="line">    daemon <span class="variable">$nginx</span> -c <span class="variable">$NGINX_CONF_FILE</span></span><br><span class="line">    retval=$?</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    [ <span class="variable">$retval</span> -eq 0 ] &amp;&amp; touch <span class="variable">$lockfile</span></span><br><span class="line">    <span class="built_in">return</span> <span class="variable">$retval</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">stop</span></span>() &#123;</span><br><span class="line">    <span class="built_in">echo</span> -n $<span class="string">"Stopping <span class="variable">$prog</span>: "</span></span><br><span class="line">    killproc <span class="variable">$prog</span> -QUIT</span><br><span class="line">    retval=$?</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">    [ <span class="variable">$retval</span> -eq 0 ] &amp;&amp; rm -f <span class="variable">$lockfile</span></span><br><span class="line">    <span class="built_in">return</span> <span class="variable">$retval</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">restart</span></span>() &#123;</span><br><span class="line">    configtest || <span class="built_in">return</span> $?</span><br><span class="line">    stop</span><br><span class="line">    sleep 1</span><br><span class="line">    start</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">reload</span></span>() &#123;</span><br><span class="line">    configtest || <span class="built_in">return</span> $?</span><br><span class="line">    <span class="built_in">echo</span> -n $<span class="string">"Reloading <span class="variable">$prog</span>: "</span></span><br><span class="line">    killproc <span class="variable">$nginx</span> -HUP</span><br><span class="line">    RETVAL=$?</span><br><span class="line">    <span class="built_in">echo</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">force_reload</span></span>() &#123;</span><br><span class="line">    restart</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">configtest</span></span>() &#123;</span><br><span class="line">  <span class="variable">$nginx</span> -t -c <span class="variable">$NGINX_CONF_FILE</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">rh_status</span></span>() &#123;</span><br><span class="line">    status <span class="variable">$prog</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">rh_status_q</span></span>() &#123;</span><br><span class="line">    rh_status &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$1</span>"</span> <span class="keyword">in</span></span><br><span class="line">    start)</span><br><span class="line">        rh_status_q &amp;&amp; <span class="built_in">exit</span> 0</span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        rh_status_q || <span class="built_in">exit</span> 0</span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    restart|configtest)</span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    reload)</span><br><span class="line">        rh_status_q || <span class="built_in">exit</span> 7</span><br><span class="line">        <span class="variable">$1</span></span><br><span class="line">        ;;</span><br><span class="line">    force-reload)</span><br><span class="line">        force_reload</span><br><span class="line">        ;;</span><br><span class="line">    status)</span><br><span class="line">        rh_status</span><br><span class="line">        ;;</span><br><span class="line">    condrestart|try-restart)</span><br><span class="line">        rh_status_q || <span class="built_in">exit</span> 0</span><br><span class="line">            ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> $<span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest&#125;"</span></span><br><span class="line">        <span class="built_in">exit</span> 2</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure>


<p>配置自动启动：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@web ~]<span class="comment"># chmod a+x  /etc/init.d/nginx</span></span><br><span class="line">chkconfig --add /etc/init.d/nginx</span><br><span class="line">chkconfig nginx on</span><br></pre></td></tr></table></figure>

<p>删除自动启动：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@web nginx]<span class="comment"># chkconfig --del /etc/init.d/nginx </span></span><br><span class="line">[root@web nginx]<span class="comment"># chkconfig nginx off</span></span><br></pre></td></tr></table></figure>

<p>如果不创建/usr/local/nginx/logs会有错误提示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@web run]<span class="comment"># systemctl status nginx</span></span><br><span class="line">● nginx.service - SYSV: NGINX is an HTTP(S) server, HTTP(S) reverse proxy and IMAP/POP3 proxy server</span><br><span class="line">   Loaded: loaded (/etc/rc.d/init.d/nginx; bad; vendor preset: disabled)</span><br><span class="line">   Active: failed (Result: timeout) since Wed 2020-04-01 10:03:52 CST; 2min 22s ago</span><br><span class="line">     Docs: man:systemd-sysv-generator(8)</span><br><span class="line">  Process: 1555 ExecStart=/etc/rc.d/init.d/nginx start (code=exited, status=0/SUCCESS)</span><br><span class="line"></span><br><span class="line">Apr 01 09:58:51 web systemd[1]: Starting SYSV: NGINX is an HTTP(S) server, HTTP(S) reverse proxy and IMAP/POP3 proxy server...</span><br><span class="line">Apr 01 09:58:52 web nginx[1555]: Starting nginx: [  OK  ]</span><br><span class="line">Apr 01 09:58:52 web systemd[1]: Can<span class="string">'t open PID file /usr/local/nginx/logs/nginx.pid (yet?) after start: No such file or directory</span></span><br><span class="line"><span class="string">Apr 01 10:03:52 web systemd[1]: nginx.service start operation timed out. Terminating.</span></span><br><span class="line"><span class="string">Apr 01 10:03:52 web systemd[1]: Failed to start SYSV: NGINX is an HTTP(S) server, HTTP(S) reverse proxy and IMAP/POP3 proxy server.</span></span><br><span class="line"><span class="string">Apr 01 10:03:52 web systemd[1]: Unit nginx.service entered failed state.</span></span><br><span class="line"><span class="string">Apr 01 10:03:52 web systemd[1]: nginx.service failed.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">解决办法，可增加目录：</span></span><br><span class="line"><span class="string">[root@web nginx]# mkdir /usr/local/nginx/logs</span></span><br></pre></td></tr></table></figure>

<h2 id="四、启动测试"><a href="#四、启动测试" class="headerlink" title="四、启动测试"></a>四、启动测试</h2><p>启动nginx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@web nginx]<span class="comment"># systemctl start nginx</span></span><br><span class="line">or</span><br><span class="line">[root@web sbin]<span class="comment"># cd /usr/local/nginx/</span></span><br><span class="line">[root@web nginx]<span class="comment"># ./sbin/nginx</span></span><br></pre></td></tr></table></figure>

<p>其他功能：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动</span></span><br><span class="line">systemctl start nginx</span><br><span class="line"><span class="comment"># 查看状态</span></span><br><span class="line">systemctl status nginx</span><br><span class="line"><span class="comment"># 停止</span></span><br><span class="line">systemctl stop nginx</span><br><span class="line"></span><br><span class="line">或者：</span><br><span class="line">nginx  <span class="comment">#启动nginx</span></span><br><span class="line">nginx -s quit  <span class="comment">#快速停止nginx</span></span><br><span class="line">nginx -V <span class="comment">#查看版本，以及配置文件地址</span></span><br><span class="line">nginx -v <span class="comment">#查看版本</span></span><br><span class="line">nginx -s reload|reopen|stop|quit   <span class="comment">#重新加载配置|重启|快速停止|安全关闭nginx</span></span><br><span class="line">nginx -h <span class="comment">#帮助</span></span><br><span class="line"><span class="comment"># 测试配置是否正确</span></span><br><span class="line">nginx -t</span><br></pre></td></tr></table></figure>
<p>打开浏览器直接访问（不能访问请关闭防火墙）：<br><a href="http://192.169.19.135/" target="_blank" rel="noopener">http://192.169.19.135/</a></p>
<h2 id="五、其他性能修改（可选）"><a href="#五、其他性能修改（可选）" class="headerlink" title="五、其他性能修改（可选）"></a>五、其他性能修改（可选）</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@web nginx]# pwd</span><br><span class="line">/usr/local/nginx/conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改软件运行权限 配置工作进程数量、打开文件数量限制</span></span><br><span class="line">[root@web nginx]# vim nginx.conf</span><br><span class="line"><span class="attribute">user</span>  nginx nginx;</span><br><span class="line"><span class="attribute">worker_processes</span> auto;</span><br><span class="line"><span class="attribute">worker_rlimit_nofile</span> <span class="number">51200</span>;</span><br><span class="line"><span class="attribute">pid</span>        /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line">events</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attribute">use</span> <span class="literal">epoll</span>;</span><br><span class="line">        <span class="attribute">worker_connections</span> <span class="number">51200</span>;</span><br><span class="line">        <span class="attribute">multi_accept</span> <span class="literal">on</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://majunbo.top/20200513/kunpeng09-nginx-install/" data-id="ckadpcfqv0000bj9xfcoo1uiw" class="article-share-link">分享到</a>
      

      

      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kunpeng/" rel="tag">kunpeng</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-kunpeng08-nodejscms" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20200512/kunpeng08-nodejscms/" class="article-date">
  <time datetime="2020-05-12T15:30:16.000Z" itemprop="datePublished">2020-05-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20200512/kunpeng08-nodejscms/">鲲鹏服务器实验八：部署Node.js系统</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>本网站就是使用node.js语言搭建的系统。</p>
</blockquote>
<p>node官方网站: <a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">https://nodejs.org/en/download/</a></p>
<h2 id="一、安装node服务器"><a href="#一、安装node服务器" class="headerlink" title="一、安装node服务器"></a>一、安装node服务器</h2><h3 id="1-下载编译好的软件"><a href="#1-下载编译好的软件" class="headerlink" title="1)下载编译好的软件"></a>1)下载编译好的软件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@web ~]<span class="comment"># cd /opt</span></span><br><span class="line">[root@web opt]<span class="comment"># wget https://nodejs.org/dist/v12.16.1/node-v12.16.1-linux-arm64.tar.xz</span></span><br><span class="line">[root@web opt]<span class="comment"># tar -xvf node-v12.16.1-linux-arm64.tar.xz </span></span><br><span class="line">[root@web opt]<span class="comment"># cd node-v12.16.1-linux-arm64</span></span><br><span class="line"><span class="comment"># 创建软链接，可以在系统中直接使用node命令</span></span><br><span class="line">[root@web node-v12.16.1-linux-arm64]<span class="comment"># ln -s /opt/node-v12.16.1-linux-arm64/bin/node /usr/local/bin/node</span></span><br><span class="line">[root@web node-v12.16.1-linux-arm64]<span class="comment"># ln -s /opt/node-v12.16.1-linux-arm64/bin/npm /usr/local/bin/npm</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者不创建软链接，配置系统级别（用户级别）node软件环境变量(以/usr/local/nodexxx为例)：</span></span><br><span class="line">[root@web ~]<span class="comment"># vim /etc/profile</span></span><br><span class="line"><span class="comment"># add by majunbo.top</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/usr/<span class="built_in">local</span>/node-v12.16.1-linux-arm64/bin</span><br></pre></td></tr></table></figure>
<h3 id="2-编辑文件测试"><a href="#2-编辑文件测试" class="headerlink" title="2)编辑文件测试"></a>2)编辑文件测试</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@web mnt]# vim  example.js</span><br><span class="line">const http &#x3D; require(&#39;http&#39;);</span><br><span class="line">const hostname &#x3D; &#39;0.0.0.0&#39;;</span><br><span class="line">const port &#x3D; 3000;</span><br><span class="line">const server &#x3D; http.createServer((req, res) &#x3D;&gt; &#123;  </span><br><span class="line">    res.statusCode &#x3D; 200;</span><br><span class="line">    res.setHeader(&#39;Content-Type&#39;, &#39;text&#x2F;plain&#39;);</span><br><span class="line">    res.end(&#39;Welcome to Node.js\n&#39;);</span><br><span class="line">&#125;);  </span><br><span class="line"> </span><br><span class="line">server.listen(port, hostname, () &#x3D;&gt; &#123;  </span><br><span class="line">    console.log(&#96;Server running at http:&#x2F;&#x2F;$&#123;hostname&#125;:$&#123;port&#125;&#x2F;&#96;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"># 运行js测试文件</span><br><span class="line">[root@web mnt]# node example.js &amp;</span><br></pre></td></tr></table></figure>
<h3 id="3-浏览器打开网站"><a href="#3-浏览器打开网站" class="headerlink" title="3)浏览器打开网站"></a>3)浏览器打开网站</h3><p><a href="http://your_ip:3000" target="_blank" rel="noopener">http://your_ip:3000</a></p>
<h3 id="4-源码安装-Node-js（可选）"><a href="#4-源码安装-Node-js（可选）" class="headerlink" title="4)源码安装 Node.js（可选）"></a>4)源码安装 Node.js（可选）</h3><p>在Raspberry 1代中编译安装node.js 12，系统安装的Raspbian 10，但是硬件版本应该是armv6，node.js官网没有编译好的对应软件，只有V7\V8。</p>
<blockquote>
<p>官方说明：<a href="https://github.com/nodejs/node/blob/master/BUILDING.md#building-nodejs-1" target="_blank" rel="noopener">https://github.com/nodejs/node/blob/master/BUILDING.md#building-nodejs-1</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@pi:~<span class="comment"># cat /etc/issue</span></span><br><span class="line">Raspbian GNU/Linux 10 \n \l</span><br><span class="line">[root@pi ~]<span class="comment"># cd /opt</span></span><br><span class="line">[root@pi /opt]<span class="comment"># wget https://nodejs.org/dist/v12.16.2/node-v12.16.2.tar.gz</span></span><br><span class="line">[root@pi /opt]<span class="comment"># tar -zxvf node-v12.16.2.tar.gz</span></span><br><span class="line">[root@pi /opt]<span class="comment"># cd node-v12.16.2</span></span><br><span class="line">[root@pi /opt/node-v12.16.2]<span class="comment"># ./configure</span></span><br><span class="line">or</span><br><span class="line">[root@pi /opt/node-v12.16.2]<span class="comment"># ./configure --prefix=/usr/local/node/12.16.2</span></span><br><span class="line"></span><br><span class="line">[root@pi /opt/node-v12.16.2]<span class="comment"># make -j2</span></span><br><span class="line">[root@pi /opt/node-v12.16.2]<span class="comment"># make install </span></span><br><span class="line">[root@pi /opt/node-v12.16.2]<span class="comment"># node --version</span></span><br><span class="line">[root@pi /opt/node-v12.16.2]<span class="comment"># npm --version</span></span><br></pre></td></tr></table></figure>
<p>编辑环境变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@pi ~]<span class="comment"># vim /etc/profile</span></span><br><span class="line"><span class="comment">#set for nodejs</span></span><br><span class="line"><span class="built_in">export</span> NODE_HOME=/usr/<span class="built_in">local</span>/node/12.16.2</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$NODE_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line">[root@pi ~]<span class="comment"># source /etc/profile</span></span><br></pre></td></tr></table></figure>

<p>也可直接apt install安装，使用以下方式安装的版本为10：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@pi:/opt<span class="comment"># apt install nodejs</span></span><br><span class="line">root@pi:/opt<span class="comment"># node -v</span></span><br><span class="line">v10.15.2</span><br></pre></td></tr></table></figure>

<p>Raspbian 10默认只有99M的SWAP，编译软件时会死机，解决办法是增加swap空间：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">sudo mkdir image</span><br><span class="line"><span class="built_in">cd</span> image</span><br><span class="line">sudo touch swap    <span class="comment">#创建文件</span></span><br><span class="line">sudo dd <span class="keyword">if</span>=/dev/zero of=/opt/image/swap bs=1024 count=1024000  <span class="comment">#添加交换文件并设置为1G</span></span><br><span class="line"><span class="comment">#过段时间会返回(这个略慢)</span></span><br><span class="line"><span class="comment">#1024000+0 records in</span></span><br><span class="line"><span class="comment">#1024000+0 records out</span></span><br><span class="line"><span class="comment">#大小 copied, 所用时间 s, 速度 MB/s</span></span><br><span class="line">sudo mkswap /opt/image/swap  <span class="comment">#设置交换空间</span></span><br><span class="line"></span><br><span class="line">sudo swapon /opt/image/swap  <span class="comment">#启用新增的交换空间</span></span><br><span class="line">free -m    <span class="comment">#确认是否已经生效</span></span><br><span class="line"></span><br><span class="line">sudo vim /etc/fstab</span><br><span class="line">/opt/image/swap    /swap    swap    defaults 0 0</span><br><span class="line"><span class="comment">#继续编译</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#移除SWAP分区</span></span><br><span class="line">sudo swapoff -v /opt/image/swap</span><br><span class="line"><span class="comment">#在 /etc/fstab 文件中删除有效 swap 的行。</span></span><br><span class="line"><span class="comment">#最后执行以下命令删除 swapfile 文件：</span></span><br><span class="line">sudo rm /opt/image/swap</span><br></pre></td></tr></table></figure>

<p><strong>编译了三天三夜，终于完成！ yeah!</strong></p>
<h2 id="二、部署hexo框架-轻量级博客框架"><a href="#二、部署hexo框架-轻量级博客框架" class="headerlink" title="二、部署hexo框架-轻量级博客框架"></a>二、部署hexo框架-轻量级博客框架</h2><p>这套软件官网：<a href="https://hexo.io/zh-cn/index.html" target="_blank" rel="noopener">https://hexo.io/zh-cn/index.html</a></p>
<p>【Hexo 静态博客框架』是一个纯静态的博客网站框架，也就是一款基于 Node.js 的静态博客框架，依赖少、易于安装使用，可以方便的生成静态网页托管在服务器上，并且Hexo 使用 <code>Markdown</code>（或其他渲染引擎）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。</p>
<p>Hexo博客的开发与部署流程<br>接下来简单阐述一下一个之前从未接触过Hexo的折腾党是如何在两天内搭建并部署的：</p>
<h3 id="1-安装hexo软件所有操作命令"><a href="#1-安装hexo软件所有操作命令" class="headerlink" title="1)安装hexo软件所有操作命令"></a>1)安装hexo软件所有操作命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所有操作步骤</span></span><br><span class="line">npm install hexo-cli -g</span><br><span class="line">hexo init blog</span><br><span class="line"><span class="built_in">cd</span> blog</span><br><span class="line">npm install</span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure>

<h3 id="2-Hexo详细部署操作日志"><a href="#2-Hexo详细部署操作日志" class="headerlink" title="2)Hexo详细部署操作日志"></a>2)Hexo详细部署操作日志</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 软件安装</span></span><br><span class="line">[root@web mnt]<span class="comment"># npm install hexo-cli -g</span></span><br><span class="line">npm WARN deprecated mkdirp@0.5.4: Legacy versions of mkdirp are no longer supported. Please update to mkdirp 1.x. (Note that the API surface has changed to use Promises <span class="keyword">in</span> 1.x.)</span><br><span class="line">/usr/<span class="built_in">local</span>/node-v12.16.1-linux-arm64/bin/hexo -&gt; /usr/<span class="built_in">local</span>/node-v12.16.1-linux-arm64/lib/node_modules/hexo-cli/bin/hexo</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@~2.1.2 (node_modules/hexo-cli/node_modules/chokidar/node_modules/fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform <span class="keyword">for</span> fsevents@2.1.2: wanted &#123;<span class="string">"os"</span>:<span class="string">"darwin"</span>,<span class="string">"arch"</span>:<span class="string">"any"</span>&#125; (current: &#123;<span class="string">"os"</span>:<span class="string">"linux"</span>,<span class="string">"arch"</span>:<span class="string">"arm64"</span>&#125;)</span><br><span class="line"></span><br><span class="line">+ hexo-cli@3.1.0</span><br><span class="line">updated 1 package <span class="keyword">in</span> 30.447s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个hexo软链接，因为下面要用hexo命令</span></span><br><span class="line">[root@web mnt]<span class="comment"># ln -s /usr/local/node-v12.16.1-linux-arm64/bin/hexo /usr/local/bin/hexo</span></span><br><span class="line">[root@web mnt]<span class="comment"># hexo -V</span></span><br><span class="line">hexo-cli: 3.1.0</span><br><span class="line">os: Linux 4.18.0-147.0.3.el7.aarch64 linux arm64</span><br><span class="line">node: 12.16.1</span><br><span class="line">v8: 7.8.279.23-node.31</span><br><span class="line">uv: 1.34.0</span><br><span class="line">zlib: 1.2.11</span><br><span class="line">brotli: 1.0.7</span><br><span class="line">ares: 1.15.0</span><br><span class="line">modules: 72</span><br><span class="line">nghttp2: 1.40.0</span><br><span class="line">napi: 5</span><br><span class="line">llhttp: 2.0.4</span><br><span class="line">http_parser: 2.9.3</span><br><span class="line">openssl: 1.1.1d</span><br><span class="line">cldr: 35.1</span><br><span class="line">icu: 64.2</span><br><span class="line">tz: 2019c</span><br><span class="line">unicode: 12.1</span><br><span class="line">[root@web mnt]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化博客</span></span><br><span class="line">[root@web mnt]<span class="comment"># hexo init blog</span></span><br><span class="line">INFO  Cloning hexo-starter https://github.com/hexojs/hexo-starter.git</span><br><span class="line">Cloning into <span class="string">'/mnt/blog'</span>...</span><br><span class="line">remote: Enumerating objects: 30, <span class="keyword">done</span>.</span><br><span class="line">remote: Counting objects: 100% (30/30), <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (24/24), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 161 (delta 12), reused 12 (delta 4), pack-reused 131</span><br><span class="line">Receiving objects: 100% (161/161), 31.79 KiB | 6.00 KiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (74/74), <span class="keyword">done</span>.</span><br><span class="line">Submodule <span class="string">'themes/landscape'</span> (https://github.com/hexojs/hexo-theme-landscape.git) registered <span class="keyword">for</span> path <span class="string">'themes/landscape'</span></span><br><span class="line">Cloning into <span class="string">'themes/landscape'</span>...</span><br><span class="line">remote: Enumerating objects: 1063, <span class="keyword">done</span>.</span><br><span class="line">remote: Total 1063 (delta 0), reused 0 (delta 0), pack-reused 1063</span><br><span class="line">Receiving objects: 100% (1063/1063), 3.21 MiB | 9.00 KiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (585/585), <span class="keyword">done</span>.</span><br><span class="line">Submodule path <span class="string">'themes/landscape'</span>: checked out <span class="string">'73a23c51f8487cfcd7c6deec96ccc7543960d350'</span></span><br><span class="line">INFO  Install dependencies</span><br><span class="line">npm WARN deprecated mkdirp@0.5.4: Legacy versions of mkdirp are no longer supported. Please update to mkdirp 1.x. (Note that the API surface has changed to use Promises <span class="keyword">in</span> 1.x.)</span><br><span class="line">npm WARN deprecated urix@0.1.0: Please see https://github.com/lydell/urix<span class="comment">#deprecated</span></span><br><span class="line">npm WARN deprecated resolve-url@0.2.1: https://github.com/lydell/resolve-url<span class="comment">#deprecated</span></span><br><span class="line"></span><br><span class="line">&gt; ejs@2.7.4 postinstall /mnt/blog/node_modules/ejs</span><br><span class="line">&gt; node ./postinstall.js</span><br><span class="line"></span><br><span class="line">Thank you <span class="keyword">for</span> installing EJS: built with the Jake JavaScript build tool (https://jakejs.com/)</span><br><span class="line"></span><br><span class="line">npm notice created a lockfile as package-lock.json. You should commit this file.</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@~2.1.2 (node_modules/chokidar/node_modules/fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform <span class="keyword">for</span> fsevents@2.1.2: wanted &#123;<span class="string">"os"</span>:<span class="string">"darwin"</span>,<span class="string">"arch"</span>:<span class="string">"any"</span>&#125; (current: &#123;<span class="string">"os"</span>:<span class="string">"linux"</span>,<span class="string">"arch"</span>:<span class="string">"arm64"</span>&#125;)</span><br><span class="line"></span><br><span class="line">added 253 packages from 450 contributors and audited 470 packages <span class="keyword">in</span> 14.121s</span><br><span class="line"></span><br><span class="line">5 packages are looking <span class="keyword">for</span> funding</span><br><span class="line">  run `npm fund` <span class="keyword">for</span> details</span><br><span class="line"></span><br><span class="line">found 1 low severity vulnerability</span><br><span class="line">  run `npm audit fix` to fix them, or `npm audit` <span class="keyword">for</span> details</span><br><span class="line">INFO  Start blogging with Hexo!</span><br><span class="line">[root@web mnt]<span class="comment"># </span></span><br><span class="line"><span class="comment">#如果这一步出错，请安装git：</span></span><br><span class="line">root@pi:/mnt <span class="comment"># npm install</span></span><br><span class="line">npm WARN mnt@1.0.0 No description</span><br><span class="line">npm WARN mnt@1.0.0 No repository field.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装博客</span></span><br><span class="line">[root@web mnt]<span class="comment"># cd blog</span></span><br><span class="line">[root@web blog]<span class="comment"># npm install</span></span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@2.1.2 (node_modules/fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform <span class="keyword">for</span> fsevents@2.1.2: wanted &#123;<span class="string">"os"</span>:<span class="string">"darwin"</span>,<span class="string">"arch"</span>:<span class="string">"any"</span>&#125; (current: &#123;<span class="string">"os"</span>:<span class="string">"linux"</span>,<span class="string">"arch"</span>:<span class="string">"arm64"</span>&#125;)</span><br><span class="line"></span><br><span class="line">audited 470 packages <span class="keyword">in</span> 2.626s</span><br><span class="line"></span><br><span class="line">5 packages are looking <span class="keyword">for</span> funding</span><br><span class="line">  run `npm fund` <span class="keyword">for</span> details</span><br><span class="line"></span><br><span class="line">found 1 low severity vulnerability</span><br><span class="line">  run `npm audit fix` to fix them, or `npm audit` <span class="keyword">for</span> details</span><br><span class="line">[root@web blog]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动hexo测试，默认端口4000</span></span><br><span class="line">[root@web blog]<span class="comment"># hexo server</span></span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Hexo is running at http://localhost:4000 . Press Ctrl+C to stop.</span><br><span class="line">^CINFO  Catch you later</span><br><span class="line"><span class="comment"># hexo s简写也可启动</span></span><br><span class="line">[root@web blog]<span class="comment"># hexo s</span></span><br><span class="line"><span class="comment"># hexo s -p xxxx 更改端口</span></span><br><span class="line">[root@web blog]<span class="comment"># hexo s -p 8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 产生静态页面</span></span><br><span class="line">[root@web blog]<span class="comment"># hexo generate</span></span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Files loaded <span class="keyword">in</span> 177 ms</span><br><span class="line">INFO  Generated: index.html</span><br><span class="line">INFO  Generated: archives/index.html</span><br><span class="line">INFO  Generated: fancybox/blank.gif</span><br><span class="line">INFO  Generated: fancybox/jquery.fancybox.css</span><br><span class="line">INFO  Generated: fancybox/jquery.fancybox.js</span><br><span class="line">INFO  Generated: fancybox/jquery.fancybox.pack.js</span><br><span class="line">INFO  Generated: fancybox/fancybox_loading.gif</span><br><span class="line">INFO  Generated: fancybox/fancybox_loading@2x.gif</span><br><span class="line">INFO  Generated: fancybox/fancybox_overlay.png</span><br><span class="line">INFO  Generated: fancybox/fancybox_sprite.png</span><br><span class="line">INFO  Generated: fancybox/fancybox_sprite@2x.png</span><br><span class="line">INFO  Generated: archives/2020/04/index.html</span><br><span class="line">INFO  Generated: archives/2020/index.html</span><br><span class="line">INFO  Generated: css/fonts/FontAwesome.otf</span><br><span class="line">INFO  Generated: js/script.js</span><br><span class="line">INFO  Generated: fancybox/helpers/jquery.fancybox-buttons.css</span><br><span class="line">INFO  Generated: fancybox/helpers/jquery.fancybox-buttons.js</span><br><span class="line">INFO  Generated: fancybox/helpers/jquery.fancybox-media.js</span><br><span class="line">INFO  Generated: fancybox/helpers/jquery.fancybox-thumbs.css</span><br><span class="line">INFO  Generated: fancybox/helpers/jquery.fancybox-thumbs.js</span><br><span class="line">INFO  Generated: css/style.css</span><br><span class="line">INFO  Generated: css/fonts/fontawesome-webfont.eot</span><br><span class="line">INFO  Generated: css/fonts/fontawesome-webfont.woff</span><br><span class="line">INFO  Generated: fancybox/helpers/fancybox_buttons.png</span><br><span class="line">INFO  Generated: css/fonts/fontawesome-webfont.svg</span><br><span class="line">INFO  Generated: css/fonts/fontawesome-webfont.ttf</span><br><span class="line">INFO  Generated: 2020/04/03/hello-world/index.html</span><br><span class="line">INFO  Generated: css/images/banner.jpg</span><br><span class="line">INFO  28 files generated <span class="keyword">in</span> 532 ms</span><br><span class="line">[root@web blog]<span class="comment"># ls -l public/</span></span><br><span class="line">total 28</span><br><span class="line">drwxr-xr-x 3 root root 4096 Apr  3 10:03 2020</span><br><span class="line">drwxr-xr-x 3 root root 4096 Apr  3 10:03 archives</span><br><span class="line">drwxr-xr-x 4 root root 4096 Apr  3 10:03 css</span><br><span class="line">drwxr-xr-x 3 root root 4096 Apr  3 10:03 fancybox</span><br><span class="line">-rw-r--r-- 1 root root 6748 Apr  3 10:03 index.html</span><br><span class="line">drwxr-xr-x 2 root root 4096 Apr  3 10:03 js</span><br><span class="line">[root@web blog]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装RSS插件，网友可订阅：</span></span><br><span class="line">npm install hexo-generator-feed --save</span><br><span class="line"><span class="comment"># 启用插件(在hexo\_config.yml文件添加插件配置项：)：</span></span><br><span class="line"><span class="comment">#RSS订阅</span></span><br><span class="line">plugin:</span><br><span class="line">- hexo-generator-feed</span><br><span class="line"><span class="comment">#Feed Atom</span></span><br><span class="line">feed:</span><br><span class="line">  <span class="built_in">type</span>: atom</span><br><span class="line">  path: atom.xml</span><br><span class="line">  <span class="built_in">limit</span>: 20</span><br></pre></td></tr></table></figure>

<p>华为的EulerOS系统部署hexo过程中出错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[root@euler mnt]# hexo init blog</span><br><span class="line">INFO  Cloning hexo-starter https:&#x2F;&#x2F;github.com&#x2F;hexojs&#x2F;hexo-starter.git</span><br><span class="line">Cloning into &#39;&#x2F;mnt&#x2F;blog&#39;...</span><br><span class="line">remote: Enumerating objects: 30, done.</span><br><span class="line">remote: Counting objects: 100% (30&#x2F;30), done.</span><br><span class="line">remote: Compressing objects: 100% (24&#x2F;24), done.</span><br><span class="line">remote: Total 161 (delta 12), reused 12 (delta 4), pack-reused 131</span><br><span class="line">Receiving objects: 100% (161&#x2F;161), 31.79 KiB | 13.00 KiB&#x2F;s, done.</span><br><span class="line">Resolving deltas: 100% (74&#x2F;74), done.</span><br><span class="line">Submodule &#39;themes&#x2F;landscape&#39; (https:&#x2F;&#x2F;github.com&#x2F;hexojs&#x2F;hexo-theme-landscape.git) registered for path &#39;themes&#x2F;landscape&#39;</span><br><span class="line">Cloning into &#39;&#x2F;mnt&#x2F;blog&#x2F;themes&#x2F;landscape&#39;...</span><br><span class="line">remote: Enumerating objects: 1063, done.        </span><br><span class="line">remote: Total 1063 (delta 0), reused 0 (delta 0), pack-reused 1063        </span><br><span class="line">Receiving objects: 100% (1063&#x2F;1063), 3.21 MiB | 9.00 KiB&#x2F;s, done.</span><br><span class="line">Resolving deltas: 100% (585&#x2F;585), done.</span><br><span class="line">Submodule path &#39;themes&#x2F;landscape&#39;: checked out &#39;73a23c51f8487cfcd7c6deec96ccc7543960d350&#39;</span><br><span class="line">INFO  Install dependencies</span><br><span class="line">npm WARN deprecated urix@0.1.0: Please see https:&#x2F;&#x2F;github.com&#x2F;lydell&#x2F;urix#deprecated</span><br><span class="line">npm WARN deprecated resolve-url@0.2.1: https:&#x2F;&#x2F;github.com&#x2F;lydell&#x2F;resolve-url#deprecated</span><br><span class="line"></span><br><span class="line">&gt; ejs@2.7.4 postinstall &#x2F;mnt&#x2F;blog&#x2F;node_modules&#x2F;ejs</span><br><span class="line">&gt; node .&#x2F;postinstall.js</span><br><span class="line"></span><br><span class="line">internal&#x2F;modules&#x2F;cjs&#x2F;loader.js:985</span><br><span class="line">  throw err;</span><br><span class="line">  ^</span><br><span class="line"></span><br><span class="line">Error: Cannot find module &#39;&#x2F;mnt&#x2F;blog&#x2F;node_modules&#x2F;ejs&#x2F;postinstall.js&#39;</span><br><span class="line">    at Function.Module._resolveFilename (internal&#x2F;modules&#x2F;cjs&#x2F;loader.js:982:15)</span><br><span class="line">    at Function.Module._load (internal&#x2F;modules&#x2F;cjs&#x2F;loader.js:864:27)</span><br><span class="line">    at Function.executeUserEntryPoint [as runMain] (internal&#x2F;modules&#x2F;run_main.js:74:12)</span><br><span class="line">    at internal&#x2F;main&#x2F;run_main_module.js:18:47 &#123;</span><br><span class="line">  code: &#39;MODULE_NOT_FOUND&#39;,</span><br><span class="line">  requireStack: []</span><br><span class="line">&#125;</span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@~2.1.2 (node_modules&#x2F;chokidar&#x2F;node_modules&#x2F;fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@2.1.2: wanted &#123;&quot;os&quot;:&quot;darwin&quot;,&quot;arch&quot;:&quot;any&quot;&#125; (current: &#123;&quot;os&quot;:&quot;linux&quot;,&quot;arch&quot;:&quot;arm64&quot;&#125;)</span><br><span class="line"></span><br><span class="line">npm ERR! code ELIFECYCLE</span><br><span class="line">npm ERR! errno 1</span><br><span class="line">npm ERR! ejs@2.7.4 postinstall: &#96;node .&#x2F;postinstall.js&#96;</span><br><span class="line">npm ERR! Exit status 1</span><br><span class="line">npm ERR! </span><br><span class="line">npm ERR! Failed at the ejs@2.7.4 postinstall script.</span><br><span class="line">npm ERR! This is probably not a problem with npm. There is likely additional logging output above.</span><br><span class="line"></span><br><span class="line">npm ERR! A complete log of this run can be found in:</span><br><span class="line">npm ERR!     &#x2F;root&#x2F;.npm&#x2F;_logs&#x2F;2020-04-05T11_07_04_966Z-debug.log</span><br><span class="line">WARN  Failed to install dependencies. Please run &#39;npm install&#39; manually!</span><br><span class="line">[root@euler mnt]# </span><br><span class="line">[root@euler mnt]#</span><br></pre></td></tr></table></figure>
<p>解决办法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@euler mnt]<span class="comment"># npm cache clean --force</span></span><br><span class="line">npm WARN using --force I sure hope you know what you are doing.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   ╭────────────────────────────────────────────────────────────────╮</span><br><span class="line">   │                                                                │</span><br><span class="line">   │      New minor version of npm available! 6.13.4 → 6.14.4       │</span><br><span class="line">   │   Changelog: https://github.com/npm/cli/releases/tag/v6.14.4   │</span><br><span class="line">   │               Run npm install -g npm to update!                │</span><br><span class="line">   │                                                                │</span><br><span class="line">   ╰────────────────────────────────────────────────────────────────╯</span><br><span class="line"></span><br><span class="line">升级npm</span><br><span class="line">[root@euler mnt]<span class="comment"># npm install -g npm</span></span><br><span class="line">/usr/<span class="built_in">local</span>/node-v12.16.1-linux-arm64/bin/npm -&gt; /usr/<span class="built_in">local</span>/node-v12.16.1-linux-arm64/lib/node_modules/npm/bin/npm-cli.js</span><br><span class="line">/usr/<span class="built_in">local</span>/node-v12.16.1-linux-arm64/bin/npx -&gt; /usr/<span class="built_in">local</span>/node-v12.16.1-linux-arm64/lib/node_modules/npm/bin/npx-cli.js</span><br><span class="line">+ npm@6.14.4</span><br><span class="line">added 9 packages from 5 contributors, removed 4 packages and updated 29 packages <span class="keyword">in</span> 17.015s</span><br><span class="line">[root@euler mnt]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line">[root@euler blog]<span class="comment"># npm install --save-dev node-sass</span></span><br></pre></td></tr></table></figure>

<p>执行hexo init出错，或是慢，切换NPM源：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##################</span></span><br><span class="line"><span class="comment"># 查看源</span></span><br><span class="line">npm config get registry</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">npm config list</span><br><span class="line"><span class="comment">##################</span></span><br><span class="line">[root@euler ~]<span class="comment"># npm config list</span></span><br><span class="line">; cli configs</span><br><span class="line">metrics-registry = <span class="string">"https://registry.npmjs.org/"</span></span><br><span class="line">scope = <span class="string">""</span></span><br><span class="line">user-agent = <span class="string">"npm/6.14.4 node/v12.16.1 linux arm64"</span></span><br><span class="line"></span><br><span class="line">; node bin location = /usr/<span class="built_in">local</span>/node-v12.16.1-linux-arm64/bin/node</span><br><span class="line">; cwd = /root</span><br><span class="line">; HOME = /root</span><br><span class="line">; <span class="string">"npm config ls -l"</span> to show all defaults.</span><br><span class="line"><span class="comment">##################</span></span><br><span class="line"><span class="comment"># 修改源</span></span><br><span class="line"><span class="comment"># 默认源</span></span><br><span class="line">npm config <span class="built_in">set</span> registry https://registry.npmjs.org</span><br><span class="line"><span class="comment"># https -&gt; http，这样网速就会好很多</span></span><br><span class="line">npm config <span class="built_in">set</span> registry http://registry.npmjs.org</span><br><span class="line"><span class="comment"># 如果还不能下载，就切换成淘宝源</span></span><br><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这样就可以使用 cnpm 命令来安装模块了：</span></span><br><span class="line">cnpm install 命令</span><br><span class="line">所有npm指令都要用cnpm代替</span><br></pre></td></tr></table></figure>

<h3 id="3-用hexo写日志"><a href="#3-用hexo写日志" class="headerlink" title="3)用hexo写日志"></a>3)用hexo写日志</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成一个页面-自动生成页面路径和标题</span></span><br><span class="line">[root@web blog]<span class="comment"># hexo new "post title with kunpeng"</span></span><br><span class="line"><span class="comment"># 带路径，手工指定路径kunpeng01</span></span><br><span class="line">[root@web blog]<span class="comment"># hexo new --path kunpneg01 "post title with kunpeng"</span></span><br><span class="line">INFO  Created: /mnt/blog/<span class="built_in">source</span>/_posts/kunpneg01.md</span><br><span class="line"><span class="comment"># 关于我</span></span><br><span class="line">[root@web blog]<span class="comment"># hexo new page --path about/index "About me"</span></span><br><span class="line">INFO  Created: /mnt/blog/<span class="built_in">source</span>/about/index.md</span><br><span class="line"></span><br><span class="line"><span class="comment"># 放置静态内容到内存中</span></span><br><span class="line">https://www.cnblogs.com/wangzhisdu/p/7771069.html</span><br><span class="line"><span class="comment"># 配置HTTPS ssl</span></span><br><span class="line">https://blog.csdn.net/libaineu2004/article/details/79358738</span><br><span class="line">https://www.cnblogs.com/wangzhisdu/p/7771069.html</span><br><span class="line"></span><br><span class="line">https://hufangyun.com/2019/https-config/</span><br></pre></td></tr></table></figure>

<h3 id="4-安装自定义主题"><a href="#4-安装自定义主题" class="headerlink" title="4)安装自定义主题"></a>4)安装自定义主题</h3><p>hexo主题页面：<a href="https://hexo.io/themes/" target="_blank" rel="noopener">https://hexo.io/themes/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装landscape-plus主题</span></span><br><span class="line">[root@web blog]<span class="comment"># git clone https://github.com/xiangming/landscape-plus.git themes/landscape-plus</span></span><br><span class="line">[root@web ~]<span class="comment"># vim /mnt/blog/_config.yml </span></span><br><span class="line">change this:</span><br><span class="line">theme: landscape</span><br><span class="line">to this:</span><br><span class="line">theme: landscape-plu</span><br></pre></td></tr></table></figure>

<h3 id="5-部署静态页面到nginx"><a href="#5-部署静态页面到nginx" class="headerlink" title="5)部署静态页面到nginx"></a>5)部署静态页面到nginx</h3><p>软件安装完成了，静态页面也生成了，肯定要使用世界上最牛的nginx来跑咱的博客系统了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑nginx配置文件，指向我们新生成的目录</span></span><br><span class="line">[root@web ~]<span class="comment"># vim /usr/local/nginx/conf/nginx.conf</span></span><br><span class="line">change this:</span><br><span class="line">        location / &#123;</span><br><span class="line">            root   root;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">to this:</span><br><span class="line">        location / &#123;</span><br><span class="line">            root   /mnt/blog/public;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment"># 也可以根据需要适当修改其他配置参数。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新启动nginx</span></span><br><span class="line">[root@web ~]<span class="comment"># systemctl restart nginx.service</span></span><br></pre></td></tr></table></figure>
<p>系统部署成功，也可以打开浏览器访问<br><a href="http://your_ip" target="_blank" rel="noopener">http://your_ip</a><br>或者：<br><a href="http://www.xxx.com" target="_blank" rel="noopener">http://www.xxx.com</a></p>
<p>配置theme<br><a href="https://hexo.io/themes/" target="_blank" rel="noopener">https://hexo.io/themes/</a></p>
<h3 id="6-部署静态博客到github（可选）"><a href="#6-部署静态博客到github（可选）" class="headerlink" title="6)部署静态博客到github（可选）"></a>6)部署静态博客到github（可选）</h3><p>博客系统部署完成了，不想买主机，可以把所有的页面信息发布到<a href="https://github.com" target="_blank" rel="noopener">https://github.com</a></p>
<p>0、首先购买一个域名并配置你的github账户</p>
<blockquote>
<p>购买域名略过：</p>
</blockquote>
<p>注册github-&gt;设置GitHub-&gt;并创建github page。<br>github地址: <a href="https://github.com/" target="_blank" rel="noopener">https://github.com/</a></p>
<p>1、安装 hexo-deployer-git，并配置用户信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@web blog]<span class="comment"># npm install hexo-deployer-git --save</span></span><br><span class="line">[root@web blog]<span class="comment"># git config --global user.email "you@example.com"</span></span><br><span class="line">[root@web blog]<span class="comment"># git config --global user.name "Your_Name"</span></span><br></pre></td></tr></table></figure>

<p>2、编辑blog配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@web blog]<span class="comment"># vim _config.yml</span></span><br></pre></td></tr></table></figure>

<p>3、修改_config.yml下面代码</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># change this:</span></span><br><span class="line">deploy:</span><br><span class="line">  type: ''</span><br><span class="line"><span class="comment"># to this:</span></span><br><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repository: https://github.com/xxx/xxx.github.io.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure>

<p>4、部署系统到github</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@web blog]<span class="comment"># npm install hexo-deployer-git</span></span><br><span class="line"><span class="comment"># 增加cname</span></span><br><span class="line">[root@web blog]<span class="comment"># vim source/CNAME </span></span><br><span class="line">majunbo.top</span><br><span class="line"><span class="comment"># 部署系统</span></span><br><span class="line">[root@web blog]<span class="comment"># hexo g -d</span></span><br><span class="line">INFO  Deploying: git</span><br><span class="line">INFO  Clearing .deploy_git folder...</span><br><span class="line">INFO  Copying files from public folder...</span><br><span class="line">INFO  Copying files from extend <span class="built_in">dirs</span>...</span><br><span class="line">On branch master</span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line">Username <span class="keyword">for</span> <span class="string">'https://github.com'</span>: Your_Name</span><br><span class="line">Password <span class="keyword">for</span> <span class="string">'https://your_name@github.com'</span>: </span><br><span class="line">Branch <span class="string">'master'</span> <span class="built_in">set</span> up to track remote branch <span class="string">'master'</span> from <span class="string">'https://github.com/your_name/blog.git'</span>.</span><br><span class="line">Everything up-to-date</span><br><span class="line">INFO  Deploy <span class="keyword">done</span>: git</span><br></pre></td></tr></table></figure>
<p>5、解析你的域名：</p>
<p>测试你的域名地址：ping </p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Users</span>\<span class="title">majun</span>&gt;<span class="title">ping</span> <span class="title">xxx.github.io</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Pinging</span> <span class="title">xxx.github.io</span> [185.199.109.153] <span class="title">with</span> 32 <span class="title">bytes</span> <span class="title">of</span> <span class="title">data</span>:</span></span><br><span class="line"><span class="function"><span class="title">Reply</span> <span class="title">from</span> 185.199.109.153: <span class="title">bytes</span>=32 <span class="title">time</span>=88<span class="title">ms</span> <span class="title">TTL</span>=53</span></span><br><span class="line"><span class="function"><span class="title">Reply</span> <span class="title">from</span> 185.199.109.153: <span class="title">bytes</span>=32 <span class="title">time</span>=92<span class="title">ms</span> <span class="title">TTL</span>=53</span></span><br><span class="line"><span class="function"><span class="title">Reply</span> <span class="title">from</span> 185.199.109.153: <span class="title">bytes</span>=32 <span class="title">time</span>=81<span class="title">ms</span> <span class="title">TTL</span>=53</span></span><br><span class="line"><span class="function"><span class="title">Reply</span> <span class="title">from</span> 185.199.109.153: <span class="title">bytes</span>=32 <span class="title">time</span>=78<span class="title">ms</span> <span class="title">TTL</span>=53</span></span><br></pre></td></tr></table></figure>

<p>在你的域名中增加以下配置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@	A	默认	185.199.109.153</span><br><span class="line">www	CNAME	默认	your_name.github.io</span><br></pre></td></tr></table></figure>

<p>过几分钟，打开域名测试是否可正常打开。</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://majunbo.top/20200512/kunpeng08-nodejscms/" data-id="ckadp1dm10000b39x54tmgxnc" class="article-share-link">分享到</a>
      

      

      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kunpeng/" rel="tag">kunpeng</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-kunpeng07-pythoncms" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20200511/kunpeng07-pythoncms/" class="article-date">
  <time datetime="2020-05-11T14:30:16.000Z" itemprop="datePublished">2020-05-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20200511/kunpeng07-pythoncms/">鲲鹏服务器实验七：部署Python语言系统</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>单独建立一台鲲鹏服务器，需要有GCC</p>
<h2 id="一、检查当前Python软件版本"><a href="#一、检查当前Python软件版本" class="headerlink" title="一、检查当前Python软件版本"></a>一、检查当前Python软件版本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">检查当前版本：</span><br><span class="line">[root@web ~]<span class="comment"># python</span></span><br><span class="line">Python 2.7.5 (default, Aug  7 2019, 00:57:09) </span><br><span class="line">[GCC 4.8.5 20150623 (Red Hat 4.8.5-39)] on linux2</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> or <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; <span class="built_in">exit</span>()</span><br><span class="line">[root@web ~]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line">准备依赖工具：</span><br><span class="line">[root@web Python-3.7.7]<span class="comment"># yum install wget zlib* openssl openssl-devel libffi-devel -y</span></span><br></pre></td></tr></table></figure>

<h2 id="二、安装新的Python稳定版本"><a href="#二、安装新的Python稳定版本" class="headerlink" title="二、安装新的Python稳定版本"></a>二、安装新的Python稳定版本</h2><p>官网：<a href="https://www.python.org" target="_blank" rel="noopener">https://www.python.org</a></p>
<p>直接安装：</p>
<p>[root@web ~]# yum install python3</p>
<p>下载地址：<br><a href="https://www.python.org/downloads/release/python-382/" target="_blank" rel="noopener">https://www.python.org/downloads/release/python-382/</a><br><a href="https://www.python.org/downloads/release/python-377/" target="_blank" rel="noopener">https://www.python.org/downloads/release/python-377/</a></p>
<p>1、下载Python3源代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">下载软件包：</span><br><span class="line">[root@web src]<span class="comment"># cd /usr/local/src</span></span><br><span class="line">[root@web opt]<span class="comment"># wget https://www.python.org/ftp/python/3.7.7/Python-3.7.7.tar.xz</span></span><br><span class="line">[root@web src]<span class="comment"># tar -xvf Python-3.7.7.tar.xz </span></span><br><span class="line">[root@web src]<span class="comment"># cd Python-3.7.7/</span></span><br><span class="line"></span><br><span class="line">也可以安装3.8.2版本：</span><br><span class="line">wget https://www.python.org/ftp/python/3.8.2/Python-3.8.2.tar.xz</span><br></pre></td></tr></table></figure>

<p>2、编译软件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">查询CPU核数：</span><br><span class="line">[root@web Python-3.7.7]<span class="comment"># cat /proc/cpuinfo| grep "processor"| wc -l</span></span><br><span class="line">24</span><br><span class="line"></span><br><span class="line">[root@web Python-3.7.7]<span class="comment"># ./configure --enable-optimizations --prefix=/opt/Python-3.7.7</span></span><br><span class="line">[root@web Python-3.7.7]<span class="comment"># make -j24 &amp;&amp; make install</span></span><br><span class="line"></span><br><span class="line">执行完结果是：</span><br><span class="line">...</span><br><span class="line">Looking <span class="keyword">in</span> links: /tmp/tmpddegjsbu</span><br><span class="line">Collecting setuptools</span><br><span class="line">Collecting pip</span><br><span class="line">Installing collected packages: setuptools, pip</span><br><span class="line">Successfully installed pip-19.2.3 setuptools-41.2.0</span><br><span class="line">[root@web Python-3.7.7]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line">最后给系统做一下链接文件：</span><br><span class="line">[root@web Python-3.7.7]<span class="comment"># ln -s /opt/Python-3.7.7/ /opt/python</span></span><br><span class="line">[root@web Python-3.7.7]<span class="comment"># ln -s /opt/python/bin/python3.7 /usr/bin/python3</span></span><br><span class="line">[root@web Python-3.7.7]<span class="comment"># ln -s /opt/python/bin/pip3.7 /usr/bin/pip3</span></span><br><span class="line">[root@web Python-3.7.7]<span class="comment"># ln -s /opt/python/bin/pydoc3 /usr/bin/pydoc3</span></span><br><span class="line">执行：</span><br><span class="line">ln -s /opt/Python-3.7.7/ /opt/python</span><br><span class="line">ln -s /opt/python/bin/python3.7 /usr/bin/python3</span><br><span class="line">ln -s /opt/python/bin/pip3.7 /usr/bin/pip3</span><br><span class="line">ln -s /opt/python/bin/pydoc3 /usr/bin/pydoc3</span><br></pre></td></tr></table></figure>
<p>3、查看版本<br>测试Python3是否安装完成。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查询CPU核数：</span><br><span class="line">python3 --version</span><br><span class="line">pip3 --version</span><br></pre></td></tr></table></figure>

<h2 id="三、Python框架安装Django"><a href="#三、Python框架安装Django" class="headerlink" title="三、Python框架安装Django"></a>三、Python框架安装Django</h2><p>版本说明：Django1.11-3.0<br>版本选择：Python 2.7 和 Django 1.11 的支持将会在2020年结束。<br>因为新版本的 Python 通常会更快，拥有更多特性，而且有更好的支持，推荐使用 Python 3 的最新版本。</p>
<p>框架帮助文档：<br><a href="https://docs.djangoproject.com/zh-hans/3.0/" target="_blank" rel="noopener">https://docs.djangoproject.com/zh-hans/3.0/</a></p>
<p>安装sqlite和django框架：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">升级PIP（可选）</span><br><span class="line">[root@web site-packages]<span class="comment"># pip3 install --upgrade pip</span></span><br><span class="line">安装sqlite3（可选）</span><br><span class="line">[root@web site-packages]<span class="comment"># yum install sqlite*</span></span><br><span class="line">这种方式只有python2支持sqlite，不推荐在Python3环境下安装。</span><br><span class="line"></span><br><span class="line">编译安装sqlite3：</span><br><span class="line">[root@web sqlite3]<span class="comment"># yum install sqlite-devel</span></span><br><span class="line">[root@web /]<span class="comment"># cd /opt</span></span><br><span class="line">[root@web opt]<span class="comment"># wget https://www.sqlite.org/2020/sqlite-autoconf-3310100.tar.gz</span></span><br><span class="line">[root@web sqlite-autoconf-3310100]<span class="comment"># tar -zxvf sqlite-autoconf-3310100.tar.gz</span></span><br><span class="line">[root@web sqlite-autoconf-3310100]<span class="comment"># cd sqlite-autoconf-3310100</span></span><br><span class="line">[root@web sqlite-autoconf-3310100]<span class="comment"># ./configure</span></span><br><span class="line">[root@web sqlite-autoconf-3310100]<span class="comment"># make -j8 &amp;&amp; make install</span></span><br><span class="line">[root@web sqlite-autoconf-3310100]<span class="comment"># echo export LD_LIBRARY_PATH=/usr/local/lib &gt;&gt; /etc/profile</span></span><br><span class="line">[root@web sqlite-autoconf-3310100]<span class="comment"># source /etc/profile</span></span><br><span class="line"></span><br><span class="line">[root@web sqlite-autoconf-3310100]<span class="comment"># sqlite3</span></span><br><span class="line">SQLite version 3.31.1 2020-01-27 19:55:54</span><br><span class="line">Enter <span class="string">".help"</span> <span class="keyword">for</span> usage hints.</span><br><span class="line">Connected to a transient <span class="keyword">in</span>-memory database.</span><br><span class="line">Use <span class="string">".open FILENAME"</span> to reopen on a persistent database.</span><br><span class="line">sqlite&gt; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新编译安装Python 需要新增预编译配置项为`--enable-loadable-sqlite-extensions`</span></span><br><span class="line">[root@web ~]<span class="comment"># make distclean</span></span><br><span class="line">[root@web ~]<span class="comment"># cd /usr/local/src/Python-3.7.7</span></span><br><span class="line">./configure --<span class="built_in">enable</span>-optimizations --prefix=/opt/Python-3.7.7 --<span class="built_in">enable</span>-shared --<span class="built_in">enable</span>-loadable-sqlite-extensions</span><br><span class="line"></span><br><span class="line">[root@web opt]<span class="comment"># ./configure --enable-optimizations --prefix=/opt/Python-3.7.7 --enable-shared --enable-loadable-sqlite-extensions</span></span><br><span class="line"></span><br><span class="line">[root@web opt]<span class="comment"># make -j8 &amp;&amp; make install</span></span><br><span class="line"></span><br><span class="line">编译完可能会有如下错误：</span><br><span class="line">[root@ecs-2327 Python-3.7.7]<span class="comment"># python3</span></span><br><span class="line">python3: error <span class="keyword">while</span> loading shared libraries: libpython3.7m.so.1.0: cannot open shared object file: No such file or directory</span><br><span class="line">[root@ecs-2327 Python-3.7.7]<span class="comment"># </span></span><br><span class="line">解决：</span><br><span class="line">[root@web Python-3.7.7]<span class="comment"># cp libpython3.7m.so.1.0 /usr/local/lib64/</span></span><br><span class="line">[root@web Python-3.7.7]<span class="comment"># cp libpython3.7m.so.1.0 /usr/lib</span></span><br><span class="line">[root@web Python-3.7.7]<span class="comment"># cp libpython3.7m.so.1.0 /usr/lib64/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Python编译成功后测试一下sqlite3：</span></span><br><span class="line">[root@web opt]<span class="comment"># </span></span><br><span class="line">Python 3.7.7 (default, Mar 12 2020, 12:01:24) </span><br><span class="line">[GCC 7.5.0] on linux</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> or <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; import sqlite3</span><br><span class="line">&gt;&gt;&gt; </span><br><span class="line">&gt;&gt;&gt; <span class="built_in">print</span>(sqlite3.version_info) <span class="comment">#显示sqlite3版本信息</span></span><br><span class="line">(2, 6, 0)</span><br><span class="line">&gt;&gt;&gt; </span><br><span class="line">&gt;&gt;&gt; <span class="built_in">print</span>(sqlite3.sqlite_version) <span class="comment">#显示SQLite版本信息</span></span><br><span class="line">3.7.17</span><br><span class="line">&gt;&gt;&gt; </span><br><span class="line"></span><br><span class="line">安装django框架：</span><br><span class="line">[root@web ~]<span class="comment"># python3 -m pip install django</span></span><br><span class="line">Collecting django</span><br><span class="line">  Downloading ....</span><br><span class="line">  </span><br><span class="line">如果出现超时：</span><br><span class="line">pip install *** --default-timeout=1000</span><br><span class="line">解决办法: 加大超时时间，如</span><br><span class="line">pip --default-timeout=100 install -U pip</span><br><span class="line">[root@web opt]<span class="comment"># python3 -m pip install django</span></span><br><span class="line">[root@web opt]<span class="comment"># pip3 install Django==3.0.4</span></span><br><span class="line"></span><br><span class="line">手动下载安装django，离线安装django：</span><br><span class="line">[root@web Django-3.0.4]<span class="comment"># tar -zxvf Django-3.0.4.tar.gz </span></span><br><span class="line">[root@web opt]<span class="comment"># cd Django-3.0.4</span></span><br><span class="line">[root@web Django-3.0.4]<span class="comment"># python3 setup.py install</span></span><br><span class="line">出错：</span><br><span class="line">[root@web Django-3.0.4]<span class="comment"># python3 setup.py install</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"setup.py"</span>, line 5, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    from setuptools import find_packages, setup</span><br><span class="line">  File <span class="string">"/opt/python/lib/python3.7/site-packages/setuptools/__init__.py"</span>, line 20, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    from setuptools.dist import Distribution, Feature</span><br><span class="line">  File <span class="string">"/opt/python/lib/python3.7/site-packages/setuptools/dist.py"</span>, line 35, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    from setuptools import windows_support</span><br><span class="line">  File <span class="string">"/opt/python/lib/python3.7/site-packages/setuptools/windows_support.py"</span>, line 2, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    import ctypes</span><br><span class="line">  File <span class="string">"/opt/python/lib/python3.7/ctypes/__init__.py"</span>, line 7, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    from _ctypes import Union, Structure, Array</span><br><span class="line">ModuleNotFoundError: No module named <span class="string">'_ctypes'</span></span><br><span class="line">[root@web Django-3.0.4]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line">检查问题：</span><br><span class="line">[root@web opt]<span class="comment"># ldd /usr/bin/python3</span></span><br><span class="line">	linux-vdso.so.1 =&gt;  (0x0000ffff99440000)</span><br><span class="line">	libpython3.7m.so.1.0 =&gt; /lib/libpython3.7m.so.1.0 (0x0000ffff990e0000)</span><br><span class="line">	libcrypt.so.1 =&gt; /usr/lib64/libcrypt.so.1 (0x0000ffff99080000)</span><br><span class="line">	libpthread.so.0 =&gt; /usr/lib64/libpthread.so.0 (0x0000ffff99040000)</span><br><span class="line">	libdl.so.2 =&gt; /usr/lib64/libdl.so.2 (0x0000ffff99010000)</span><br><span class="line">	libutil.so.1 =&gt; /usr/lib64/libutil.so.1 (0x0000ffff98fe0000)</span><br><span class="line">	libm.so.6 =&gt; /usr/lib64/libm.so.6 (0x0000ffff98f20000)</span><br><span class="line">	libc.so.6 =&gt; /usr/lib64/libc.so.6 (0x0000ffff98d90000)</span><br><span class="line">	libfreebl3.so =&gt; /usr/lib64/libfreebl3.so (0x0000ffff98d60000)</span><br><span class="line">	/lib/ld-linux-aarch64.so.1 (0x0000ffff99450000)</span><br><span class="line">[root@web opt]<span class="comment"># </span></span><br><span class="line">重新编译：</span><br><span class="line">[root@web Django-3.0.4]<span class="comment"># cd /usr/local/src/Python-3.7.7</span></span><br><span class="line">./configure --<span class="built_in">enable</span>-optimizations --prefix=/opt/Python-3.7.7 --<span class="built_in">enable</span>-shared --<span class="built_in">enable</span>-loadable-sqlite-extensions</span><br><span class="line">make altinstall</span><br><span class="line">[root@web Python-3.7.7]<span class="comment"># cp libpython3.7m.so.1.0 /usr/local/lib64/</span></span><br><span class="line">[root@web Python-3.7.7]<span class="comment"># cp libpython3.7m.so.1.0 /usr/lib</span></span><br><span class="line">[root@web Python-3.7.7]<span class="comment"># cp libpython3.7m.so.1.0 /usr/lib64/</span></span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line">[root@web Django-3.0.4]<span class="comment"># yum install libffi-devel -y</span></span><br><span class="line">[root@web Django-3.0.4]<span class="comment"># yum install libffi-devel </span></span><br><span class="line">[root@web Django-3.0.4]<span class="comment"># yum install sysstat bind-utils -y</span></span><br><span class="line">[root@web Django-3.0.4]<span class="comment"># yum install ntpdate tar lrzsz -y</span></span><br><span class="line">[root@web Django-3.0.4]<span class="comment"># yum install gcc gcc-c++ gcc-g77 gcc*  </span></span><br><span class="line"></span><br><span class="line">yum groupinstall <span class="string">'development tools'</span> -y</span><br><span class="line">yum update -y</span><br><span class="line"></span><br><span class="line">为了安装7.5M的django，要安装400多M的文件：</span><br><span class="line">Transaction Summary</span><br><span class="line">===========================================================================================</span><br><span class="line">Install  57 Packages (+34 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 400 M</span><br><span class="line">Installed size: 1.8 G</span><br><span class="line">Downloading packages:</span><br><span class="line"></span><br><span class="line">重新安装：</span><br><span class="line">[root@web Django-3.0.4]<span class="comment"># python3 setup.py install</span></span><br></pre></td></tr></table></figure>

<p>安装完成验证版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@web ~]<span class="comment"># python3</span></span><br><span class="line">Python 3.7.7 (default, Mar 11 2020, 21:40:23) </span><br><span class="line">[GCC 7.5.0] on linux</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> or <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; import django</span><br><span class="line">&gt;&gt;&gt; <span class="built_in">print</span>(django.get_version())</span><br><span class="line">3.0.4</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line">[root@web mnt]<span class="comment"># python3 -m django --version</span></span><br><span class="line">3.0.4</span><br></pre></td></tr></table></figure>

<p>测试web项目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">[root@web mnt]# python3 &#x2F;opt&#x2F;Python-3.7.7&#x2F;bin&#x2F;django-admin.py  startproject mysite</span><br><span class="line"></span><br><span class="line">[root@web mnt]# ls -lR mysite&#x2F;</span><br><span class="line">mysite&#x2F;:</span><br><span class="line">total 8</span><br><span class="line">-rwxr-xr-x 1 root root  626 Mar 12 11:28 manage.py</span><br><span class="line">drwxr-xr-x 2 root root 4096 Mar 12 11:28 mysite</span><br><span class="line">mysite&#x2F;mysite:</span><br><span class="line">total 16</span><br><span class="line">-rw-r--r-- 1 root root  389 Mar 12 11:28 asgi.py</span><br><span class="line">-rw-r--r-- 1 root root    0 Mar 12 11:28 __init__.py</span><br><span class="line">-rw-r--r-- 1 root root 3088 Mar 12 11:28 settings.py</span><br><span class="line">-rw-r--r-- 1 root root  748 Mar 12 11:28 urls.py</span><br><span class="line">-rw-r--r-- 1 root root  389 Mar 12 11:28 wsgi.py</span><br><span class="line">[root@web mnt]# </span><br><span class="line"></span><br><span class="line"># 打开自建的WEB应用：</span><br><span class="line">[root@web mnt]# cd mysite&#x2F;</span><br><span class="line"></span><br><span class="line">[root@web mysite]# python3 manage.py migrate</span><br><span class="line">Operations to perform:</span><br><span class="line">  Apply all migrations: admin, auth, contenttypes, sessions</span><br><span class="line">Running migrations:</span><br><span class="line">  Applying contenttypes.0001_initial... OK</span><br><span class="line">  Applying auth.0001_initial... OK</span><br><span class="line">  Applying admin.0001_initial... OK</span><br><span class="line">  Applying admin.0002_logentry_remove_auto_add... OK</span><br><span class="line">  Applying admin.0003_logentry_add_action_flag_choices... OK</span><br><span class="line">  Applying contenttypes.0002_remove_content_type_name... OK</span><br><span class="line">  Applying auth.0002_alter_permission_name_max_length... OK</span><br><span class="line">  Applying auth.0003_alter_user_email_max_length... OK</span><br><span class="line">  Applying auth.0004_alter_user_username_opts... OK</span><br><span class="line">  Applying auth.0005_alter_user_last_login_null... OK</span><br><span class="line">  Applying auth.0006_require_contenttypes_0002... OK</span><br><span class="line">  Applying auth.0007_alter_validators_add_error_messages... OK</span><br><span class="line">  Applying auth.0008_alter_user_username_max_length... OK</span><br><span class="line">  Applying auth.0009_alter_user_last_name_max_length... OK</span><br><span class="line">  Applying auth.0010_alter_group_name_max_length... OK</span><br><span class="line">  Applying auth.0011_update_proxy_permissions... OK</span><br><span class="line">  Applying sessions.0001_initial... OK</span><br><span class="line"></span><br><span class="line">运行：</span><br><span class="line">[root@web mysite]# python3 manage.py runserver</span><br><span class="line">Watching for file changes with StatReloader</span><br><span class="line">Performing system checks...</span><br><span class="line"></span><br><span class="line">System check identified no issues (0 silenced).</span><br><span class="line"></span><br><span class="line">You have 17 unapplied migration(s). Your project may not work properly until you apply the migrations for app(s): admin, auth, contenttypes, sessions.</span><br><span class="line">Run &#39;python manage.py migrate&#39; to apply them.</span><br><span class="line"></span><br><span class="line">March 12, 2020 - 04:06:52</span><br><span class="line">Django version 3.0.4, using settings &#39;mysite.settings&#39;</span><br><span class="line">Starting development server at http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;</span><br><span class="line">Quit the server with CONTROL-C.</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line">[root@web mysite]# python3 manage.py runserver 80</span><br><span class="line"></span><br><span class="line">[root@web mysite]# python3 manage.py runserver 0:80</span><br><span class="line">&#x3D;</span><br><span class="line">[root@web mysite]# python3 manage.py runserver 0.0.0.0:80</span><br></pre></td></tr></table></figure>
<p>浏览器访问：<br><a href="http://121.37.176.234:8080/" target="_blank" rel="noopener">http://121.37.176.234:8080/</a></p>
<p>如果测试出问题：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">DisallowedHost at /</span><br><span class="line">Invalid HTTP_HOST header: '121.37.176.234:8080'. You may need to add '121.37.176.234' to ALLOWED_HOSTS.</span><br><span class="line">Request Method:	GET</span><br><span class="line">Request URL:	http://121.37.176.234:8080/</span><br><span class="line">Django Version:	3.0.4</span><br><span class="line">Exception Type:	DisallowedHost</span><br><span class="line">Exception Value:	</span><br><span class="line">Invalid HTTP_HOST header: '121.37.176.234:8080'. You may need to add '121.37.176.234' to ALLOWED_HOSTS.</span><br><span class="line">Exception Location:	/opt/python/lib/python3.7/site-packages/django/http/request.py in get_host, line 122</span><br><span class="line">Python Executable:	/usr/bin/python3</span><br><span class="line">Python Version:	3.7.7</span><br><span class="line">Python Path:	</span><br><span class="line">['/mnt/mysite',</span><br><span class="line"> '/opt/python/lib/python37.zip',</span><br><span class="line"> '/opt/python/lib/python3.7',</span><br><span class="line"> '/opt/python/lib/python3.7/lib-dynload',</span><br><span class="line"> '/root/.local/lib/python3.7/site-packages',</span><br><span class="line"> '/opt/python/lib/python3.7/site-packages']</span><br><span class="line">Server time:	Thu, 12 Mar 2020 04:18:56 +0000</span><br></pre></td></tr></table></figure>
<p>修改配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@web mysite]<span class="comment"># vim mysite/settings.py </span></span><br><span class="line">change this :</span><br><span class="line">ALLOWED_HOSTS = []</span><br><span class="line">to this :</span><br><span class="line">ALLOWED_HOSTS = [<span class="string">'121.37.168.253'</span>, <span class="string">'localhost'</span>, <span class="string">'127.0.0.1'</span>]</span><br><span class="line">or</span><br><span class="line">ALLOWED_HOSTS = [<span class="string">'*'</span>]</span><br></pre></td></tr></table></figure>

<h2 id="四、部署django-cms系统wagtail"><a href="#四、部署django-cms系统wagtail" class="headerlink" title="四、部署django cms系统wagtail"></a>四、部署django cms系统wagtail</h2><p>下载wagtail </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pip install wagtail</span><br><span class="line">pip3 install wagtail</span><br><span class="line">wagtail start mysite</span><br><span class="line">cd mysite</span><br><span class="line">pip install -r requirements.txt</span><br><span class="line">python manage.py migrate</span><br><span class="line">python manage.py createsuperuser</span><br><span class="line">python manage.py runserver</span><br><span class="line"># 或者：</span><br><span class="line">python manage.py runserver 0:8080</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://majunbo.top/20200511/kunpeng07-pythoncms/" data-id="ckadom17l00009j9x7k492x9h" class="article-share-link">分享到</a>
      

      

      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kunpeng/" rel="tag">kunpeng</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-kunpeng06-javacms" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20200510/kunpeng06-javacms/" class="article-date">
  <time datetime="2020-05-10T13:50:10.000Z" itemprop="datePublished">2020-05-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20200510/kunpeng06-javacms/">鲲鹏服务器实验六：部署Java语言CMS</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>单独建立一台鲲鹏服务器，需要带有GCC\MYSQL环境。</p>
<h2 id="一、检查当前系统是否有Java"><a href="#一、检查当前系统是否有Java" class="headerlink" title="一、检查当前系统是否有Java"></a>一、检查当前系统是否有Java</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@web ~]<span class="comment"># java -version</span></span><br><span class="line">openjdk version <span class="string">"1.8.0_222-ea"</span></span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_222-ea-b03)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.222-b03, mixed mode)</span><br><span class="line"></span><br><span class="line">如果没有就执行安装命令：</span><br><span class="line">[root@web ~]<span class="comment"># yum install java</span></span><br><span class="line">...</span><br><span class="line">[root@web ~]<span class="comment"># java -version</span></span><br><span class="line">openjdk version <span class="string">"1.8.0_242"</span></span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_242-b08)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.242-b08, mixed mode)</span><br></pre></td></tr></table></figure>

<h2 id="二、安装Tomcat中间件产品"><a href="#二、安装Tomcat中间件产品" class="headerlink" title="二、安装Tomcat中间件产品"></a>二、安装Tomcat中间件产品</h2><p>1、下载Tomcat Web服务器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@web opt]# cd &#x2F;opt</span><br><span class="line">[root@web opt]# wget http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;tomcat&#x2F;tomcat-9&#x2F;v9.0.31&#x2F;bin&#x2F;apache-tomcat-9.0.31.tar.gz</span><br><span class="line">--2020-03-09 17:42:03--  http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;apache&#x2F;tomcat&#x2F;tomcat-9&#x2F;v9.0.31&#x2F;bin&#x2F;apache-tomcat-9.0.31.tar.gz</span><br><span class="line">Resolving mirrors.tuna.tsinghua.edu.cn (mirrors.tuna.tsinghua.edu.cn)... 101.6.8.193, 2402:f000:1:408:8100::1</span><br><span class="line">Connecting to mirrors.tuna.tsinghua.edu.cn (mirrors.tuna.tsinghua.edu.cn)|101.6.8.193|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 11042076 (11M) [application&#x2F;x-gzip]</span><br><span class="line">Saving to: ‘apache-tomcat-9.0.31.tar.gz’</span><br><span class="line"></span><br><span class="line">100%[&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;] 11,042,076  4.38MB&#x2F;s   in 2.4s</span><br><span class="line"></span><br><span class="line">2020-03-09 17:42:06 (4.38 MB&#x2F;s) - ‘apache-tomcat-9.0.31.tar.gz’ saved [11042076&#x2F;11042076]</span><br><span class="line"></span><br><span class="line">解压Tomcat</span><br><span class="line">[root@web opt]# tar -zxvf apache-tomcat-9.0.31.tar.gz </span><br><span class="line">[root@web opt]# cd apache-tomcat-9.0.31&#x2F;</span><br></pre></td></tr></table></figure>

<h2 id="三、安装内容管理系统jeecms"><a href="#三、安装内容管理系统jeecms" class="headerlink" title="三、安装内容管理系统jeecms"></a>三、安装内容管理系统jeecms</h2><p>1、下载CMS内容管理系统<br>下载：jeecms<br><a href="http://www.jeecms.com/download.htm" target="_blank" rel="noopener">http://www.jeecms.com/download.htm</a></p>
<p>软件下载到本地：<br>1）软件下载地址：<a href="http://dw.jeecms.com/jeecms/202002/JEECMSx1.2.0_mysql_ROOT.zip" target="_blank" rel="noopener">http://dw.jeecms.com/jeecms/202002/JEECMSx1.2.0_mysql_ROOT.zip</a><br>2）文档下载地址：<a href="http://download.jeecms.com/jeecms/202002/JEECMSx1.2.0_doc.zip" target="_blank" rel="noopener">http://download.jeecms.com/jeecms/202002/JEECMSx1.2.0_doc.zip</a></p>
<p>解压缩JEECMSx1.2.0_mysql_ROOT.zip文件，把“部署程序”中“ROOT”文件夹压缩为ROOT.zip，上传到以下目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@web webapps]<span class="comment"># pwd</span></span><br><span class="line">/opt/apache-tomcat-9.0.31/webapps</span><br><span class="line">xftp传递程序到tomcat中，并解压：</span><br><span class="line">[root@web webapps]<span class="comment"># ll</span></span><br><span class="line">total 229344</span><br><span class="line">drwxr-x--- 16 root root      4096 Mar 11 11:15 docs</span><br><span class="line">drwxr-x---  6 root root        83 Mar 11 11:15 examples</span><br><span class="line">drwxr-x---  5 root root        87 Mar 11 11:15 host-manager</span><br><span class="line">drwxr-x---  5 root root       103 Mar 11 11:15 manager</span><br><span class="line">-rw-r--r--  1 root root 234844140 Mar 11 14:57 ROOT.zip</span><br><span class="line">[root@web webapps]<span class="comment"># </span></span><br><span class="line">...</span><br><span class="line">解压程序：</span><br><span class="line">[root@web webapps]<span class="comment"># unzip ROOT.zip </span></span><br><span class="line">修改权限：</span><br><span class="line">[root@web webapps]<span class="comment"># chmod -R 755 ROOT</span></span><br></pre></td></tr></table></figure>

<p>3、创建数据库并导入数据库</p>
<p>解压缩JEECMSx1.2.0_mysql_ROOT.zip文件，把“部署程序”中“DB”jeecmsx1.2.sql，上传到/opt目录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">创建数据库</span><br><span class="line">[root@web DB]<span class="comment"># mysql -u root -p</span></span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands <span class="keyword">end</span> <span class="keyword">with</span> ; or \g.</span><br><span class="line">Your MySQL connection id is 3</span><br><span class="line">Server version: 5.7.29 Source distribution</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type '<span class="keyword">help</span>;' or '\h' for help. <span class="keyword">Type</span> <span class="string">'\c'</span> <span class="keyword">to</span> <span class="keyword">clear</span> the <span class="keyword">current</span> <span class="keyword">input</span> statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">database</span> jeecms;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; exit;</span><br><span class="line"></span><br><span class="line">导入原库：</span><br><span class="line">[root@web opt]<span class="comment"># mysql -u root -p jeecms &lt; jeecmsx1.2.sql</span></span><br><span class="line">Enter password: </span><br><span class="line"></span><br><span class="line">修改数据库配置文件：</span><br><span class="line">[root@web opt]<span class="comment"># vim /etc/my.cnf</span></span><br><span class="line">增加以下信息到</span><br><span class="line">[mysqld]</span><br><span class="line">lower_case_table_names = 1</span><br><span class="line">wait_timeout=31536000</span><br><span class="line">interactive_timeout=31536000</span><br></pre></td></tr></table></figure>

<p>4、修改配置文件：</p>
<p>修改系统数据库连接，jdbc信息  ROOT/WEB-INF/classes/application-beta.properties</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@web classes]<span class="comment"># pwd</span></span><br><span class="line">/opt/apache-tomcat-9.0.31/webapps/ROOT/WEB-INF/classes</span><br><span class="line">[root@web classes]<span class="comment"># vim application-beta.properties </span></span><br><span class="line">change this:</span><br><span class="line">spring.datasource.url=jdbc:mysql://localhost:3308/jeecms1127?useUnicode=<span class="literal">true</span>&amp;characterEncoding=UTF-8&amp;useSSL=<span class="literal">false</span></span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=password</span><br><span class="line">to this:</span><br><span class="line">spring.datasource.url=jdbc:mysql://127.0.0.1:3306/jeecms?useUnicode=<span class="literal">true</span>&amp;characterEncoding=UTF-8&amp;useSSL=<span class="literal">false</span></span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=123456</span><br></pre></td></tr></table></figure>

<p>5、启动应用系统：</p>
<p>启动Tomcat：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@web apache-tomcat-9.0.31]<span class="comment"># cd /opt/apache-tomcat-9.0.31/</span></span><br><span class="line">[root@web apache-tomcat-9.0.31]<span class="comment"># ./bin/startup.sh </span></span><br><span class="line">Using CATALINA_BASE:   /opt/apache-tomcat-9.0.31</span><br><span class="line">Using CATALINA_HOME:   /opt/apache-tomcat-9.0.31</span><br><span class="line">Using CATALINA_TMPDIR: /opt/apache-tomcat-9.0.31/temp</span><br><span class="line">Using JRE_HOME:        /usr</span><br><span class="line">Using CLASSPATH:       /opt/apache-tomcat-9.0.31/bin/bootstrap.jar:/opt/apache-tomcat-9.0.31/bin/tomcat-juli.jar</span><br><span class="line">Tomcat started.</span><br></pre></td></tr></table></figure>

<p>浏览器的地址栏中输入：<br><a href="http://192.169.19.135:8080/" target="_blank" rel="noopener">http://192.169.19.135:8080/</a><br>若系统正常显示网站首页则表示本系统顺利安装完成。</p>
<p>系统管理后台登录：<br><a href="http://192.169.19.135:8080/jeecms/index.html" target="_blank" rel="noopener">http://192.169.19.135:8080/jeecms/index.html</a><br>    用户名：system<br>    密  码：123456</p>
<p>如不能访问，要打开华为云安全组里的“入方向规则”增加8080端口，和停止ECS防火墙：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@web apache-tomcat-9.0.31]# systemctl stop firewalld.service</span><br></pre></td></tr></table></figure>
<p>如果出现以下错误信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">2020-03-11 16:10:06.748 [main] INFO  o.s.b.f.a.AutowiredAnnotationBeanPostProcessor - JSR-330 <span class="string">'javax.inject.Inject'</span> annotation found and supported <span class="keyword">for</span> autowiring</span><br><span class="line">2020-03-11 16:10:07.015 [main] INFO  org.springframework.web.context.ContextLoader - Root WebApplicationContext: initialization completed <span class="keyword">in</span> 2202 ms</span><br><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"Quartz Scheduler [schedulerFactoryBean]"</span> org.springframework.scheduling.SchedulingException: Could not start Quartz Scheduler after delay; nested exception is org.quartz.SchedulerConfigExc</span><br><span class="line">eption: Failure occured during job recovery. [See nested exception: org.quartz.impl.jdbcjobstore.LockException: Failure obtaining db row lock: Table <span class="string">'jeecms.QRTZ_LOCKS'</span> doesn<span class="string">'t exist [See nested exception: com</span></span><br><span class="line"><span class="string">.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Table '</span>jeecms.QRTZ_LOCKS<span class="string">' doesn'</span>t exist]]</span><br><span class="line">        at org.springframework.scheduling.quartz.SchedulerFactoryBean<span class="variable">$1</span>.run(SchedulerFactoryBean.java:733)</span><br><span class="line">Caused by: org.quartz.SchedulerConfigException: Failure occured during job recovery. [See nested exception: org.quartz.impl.jdbcjobstore.LockException: Failure obtaining db row lock: Table <span class="string">'jeecms.QRTZ_LOCKS'</span></span><br><span class="line">doesn<span class="string">'t exist [See nested exception: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Table '</span>jeecms.QRTZ_LOCKS<span class="string">' doesn'</span>t exist]]</span><br><span class="line">        at org.quartz.impl.jdbcjobstore.JobStoreSupport.schedulerStarted(JobStoreSupport.java:697)</span><br><span class="line">        at org.quartz.core.QuartzScheduler.start(QuartzScheduler.java:539)</span><br><span class="line">        at org.quartz.impl.StdScheduler.start(StdScheduler.java:142)</span><br><span class="line">        at org.springframework.scheduling.quartz.SchedulerFactoryBean<span class="variable">$1</span>.run(SchedulerFactoryBean.java:730)</span><br><span class="line">Caused by: org.quartz.impl.jdbcjobstore.LockException: Failure obtaining db row lock: Table <span class="string">'jeecms.QRTZ_LOCKS'</span> doesn<span class="string">'t exist [See nested exception: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: T</span></span><br><span class="line"><span class="string">able '</span>jeecms.QRTZ_LOCKS<span class="string">' doesn'</span>t exist]</span><br></pre></td></tr></table></figure>
<p>检测数据库配置文件大小写敏感信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">检查Linux下MySQL5.7.27大小写信息：</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like &#39;lower_case_table_names&#39;;</span><br><span class="line">+------------------------+-------+</span><br><span class="line">| Variable_name          | Value |</span><br><span class="line">+------------------------+-------+</span><br><span class="line">| lower_case_table_names | 0     |</span><br><span class="line">+------------------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line">mysql&gt; </span><br><span class="line"></span><br><span class="line">lower_case_table_names：0表示敏感，1表示不敏感。</span><br><span class="line"></span><br><span class="line">修改敏感信息：</span><br><span class="line">[root@web opt]# vim &#x2F;etc&#x2F;my.cnf</span><br><span class="line">增加以下信息到[mysqld]下：</span><br><span class="line">lower_case_table_names &#x3D; 1</span><br></pre></td></tr></table></figure>

<h2 id="四、安装halo博客程序："><a href="#四、安装halo博客程序：" class="headerlink" title="四、安装halo博客程序："></a>四、安装halo博客程序：</h2><p>1、下载halo<br>官网：<a href="https://halo.run/" target="_blank" rel="noopener">https://halo.run/</a></p>
<p>安装步骤：<a href="https://halo.run/archives/install-with-linux" target="_blank" rel="noopener">https://halo.run/archives/install-with-linux</a></p>
<p>注意：<br>使用 MySQL 之前，必须要先新建一个 halodb 数据库，MySQL 版本需 5.7 以上。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">create database halodb character set utf8mb4 collate utf8mb4_bin;</span><br><span class="line"></span><br><span class="line"># 示例：</span><br><span class="line">mysql&gt; create database halodb character set utf8mb4 collate utf8mb4_bin;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show create database halodb;</span><br><span class="line">+----------+----------------------------------------------------------------------------------------+</span><br><span class="line">| Database | Create Database                                                                        |</span><br><span class="line">+----------+----------------------------------------------------------------------------------------+</span><br><span class="line">| halodb   | CREATE DATABASE &#96;halodb&#96; &#x2F;*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_bin *&#x2F; |</span><br><span class="line">+----------+----------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>下载软件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.halo.run/release/halo-1.2.0.jar</span><br><span class="line">或者：</span><br><span class="line"><span class="comment"># 备用地址（建议海外服务器使用）</span></span><br><span class="line">wget https://github.com/halo-dev/halo/releases/download/v1.2.0/halo-1.2.0.jar -O halo-latest.jar</span><br></pre></td></tr></table></figure>

<p>启动测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar halo-latest.jar</span><br></pre></td></tr></table></figure>
<p><a href="http://192.169.19.135:8090/admin/index.html#/install" target="_blank" rel="noopener">http://192.169.19.135:8090/admin/index.html#/install</a></p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://majunbo.top/20200510/kunpeng06-javacms/" data-id="ckadocago00008h9xbctb18ri" class="article-share-link">分享到</a>
      

      

      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kunpeng/" rel="tag">kunpeng</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-kunpeng05-phpcms" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20200509/kunpeng05-phpcms/" class="article-date">
  <time datetime="2020-05-09T12:20:50.000Z" itemprop="datePublished">2020-05-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20200509/kunpeng05-phpcms/">鲲鹏服务器实验五：部署PHP语言CMS</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>实验前提：安装一台鲲鹏服务器，需要有GCC\MYSQL\PHP环境，并部署相关软件。<br>本文章介绍了PHP语言的开源cms三巨头Joomla wordpress drupal。</p>
<h2 id="一、部署WordPress-CMS博客软件"><a href="#一、部署WordPress-CMS博客软件" class="headerlink" title="一、部署WordPress CMS博客软件"></a>一、部署WordPress CMS博客软件</h2><p>系统要求：<br>官网推荐服务器运行PHP 7.3或更高版本，及MySQL 5.6或MariaDB 10.1或更高版本，<br>并且已经创建了对应该数据库。官网也推荐Apache或Nginx作为运行WordPress的最健壮的选项，但这些不是必须的。</p>
<p>1、下载wordpress软件<br>官方网站：<a href="https://wordpress.org/" target="_blank" rel="noopener">https://wordpress.org/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">安装数据库支持：</span><br><span class="line">[root@web html]<span class="comment"># yum install php-gd</span></span><br><span class="line"><span class="comment"># gd库是php处理图形的扩展库，gd库提供了一系列用来处理图片的API，使用GD库可以处理图片，或者生成图片。wordpress软件使用到了这个库。</span></span><br><span class="line"></span><br><span class="line">[root@web html]<span class="comment"># cd /var/www/html/</span></span><br><span class="line">[root@web html]<span class="comment"># wget https://cn.wordpress.org/latest-zh_CN.tar.gz</span></span><br><span class="line">解压文件：</span><br><span class="line">[root@web html]<span class="comment"># tar -zxvf wordpress-5.3.2-zh_CN.tar.gz</span></span><br><span class="line">[root@web wordpress]<span class="comment"># mkdir -p /var/www/html/wordpress/wp-content/uploads</span></span><br><span class="line">修改权限：</span><br><span class="line">[root@web html]<span class="comment"># chown -R apache:apache wordpress</span></span><br><span class="line">[root@web html]<span class="comment"># chmod -R 755 wordpress</span></span><br><span class="line">[root@web html]<span class="comment"># cd wordpress</span></span><br><span class="line"></span><br><span class="line">修改PHP参数，使之支持mysqli（如果已经修改可跳过）：</span><br><span class="line">[root@web wordpress]<span class="comment"># vim /usr/local/php/etc/php.ini</span></span><br><span class="line">change this (918行):</span><br><span class="line">;extension=mysqli</span><br><span class="line">to this:</span><br><span class="line">extension=mysqli</span><br></pre></td></tr></table></figure>

<p>2、创建wordpress系统数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@web html]# mysql -hlocalhost -uroot -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 3</span><br><span class="line">Server version: 5.7.29 Source distribution</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2020, Oracle and&#x2F;or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; create database wordpress;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">| wordpress          |</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; exit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure>

<p>3、测试服务器是否可以访问</p>
<p>打开已经安装的软件会自动进入自动配置流程：<br><a href="http://121.36.210.29/wordpress/" target="_blank" rel="noopener">http://121.36.210.29/wordpress/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">数据库名：wordpress</span><br><span class="line">用户名：root</span><br><span class="line">密码：xxx</span><br><span class="line">数据库主机：127.0.0.1</span><br><span class="line">表前缀：wp_</span><br></pre></td></tr></table></figure>

<p>PS:系统有可能会出错，提示：</p>
<blockquote>
<p>建立数据库连接时出错<br>这意味着您在wp-config.php文件中指定的用户名和密码信息不正确，或我们未能在127.0.0.1联系到数据库服&gt; 务器。这可能意味着您主机的数据库服务器未在运行。</p>
</blockquote>
<blockquote>
<p>您确定用户名和密码正确吗？<br>您确定输入的主机名正确吗？<br>您确定数据库服务器在运行吗？<br>如果您不明白这些意味着什么，您应该联系您的主机提供商。如果您仍需要帮助，请访问WordPress支持论坛。</p>
</blockquote>
<p>检查系统安全问题：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@web wordpress]# getsebool -a | grep mysql</span><br><span class="line">mysql_connect_any --&gt; off</span><br><span class="line">selinuxuser_mysql_connect_enabled --&gt; off</span><br><span class="line">说明启用了SElinux策略，</span><br><span class="line"></span><br><span class="line">下面配置selinux，并关闭</span><br><span class="line">[root@web wordpress]# vim &#x2F;etc&#x2F;selinux&#x2F;config </span><br><span class="line">change this:</span><br><span class="line">SELINUX&#x3D;enforcing</span><br><span class="line">to this:</span><br><span class="line">SELINUX&#x3D;disabled</span><br><span class="line">[root@web wordpress]# setenforce 0</span><br><span class="line"></span><br><span class="line">如果CentOS 7.X使用了防火墙：</span><br><span class="line">用Firewall-cmd将自定义它以允许外部访问端口80（http）和443（https）。</span><br><span class="line">firewall-cmd --permanent --zone&#x3D;public --add-service&#x3D;http </span><br><span class="line">firewall-cmd --permanent --zone&#x3D;public --add-service&#x3D;https</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<p>如果不想浏览器配置，也可手动修改配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@web wordpress]<span class="comment"># pwd</span></span><br><span class="line">/var/www/html/wordpress</span><br><span class="line">[root@web wordpress]<span class="comment"># cp wp-config-sample.php wp-config.php</span></span><br></pre></td></tr></table></figure>

<p>4、配置完成输入相关配置信息<br>打开<br><a href="http://121.36.210.29/wordpress/wp-login.php" target="_blank" rel="noopener">http://121.36.210.29/wordpress/wp-login.php</a><br>测试登录admin/password</p>
<h2 id="二、部署Joomla-CMS平台软件"><a href="#二、部署Joomla-CMS平台软件" class="headerlink" title="二、部署Joomla CMS平台软件"></a>二、部署Joomla CMS平台软件</h2><p>这套软件下载次数：<br>Downloaded over 111,000,000 times!</p>
<p>1、下载Joomla软件<br>官方网站：<a href="https://www.joomla.org/" target="_blank" rel="noopener">https://www.joomla.org/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@web html]<span class="comment"># cd /var/www/html/</span></span><br><span class="line">[root@web html]<span class="comment"># mkdir joomla</span></span><br><span class="line">[root@web html]<span class="comment"># cd joomla/</span></span><br><span class="line">[root@web joomla]<span class="comment"># wget https://downloads.joomla.org/cms/joomla3/3-9-15/Joomla_3-9-15-Stable-Full_Package.zip</span></span><br><span class="line"></span><br><span class="line">解压软件：</span><br><span class="line">[root@web joomla]<span class="comment"># unzip Joomla_3.9.15-Stable-Full_Package.zip </span></span><br><span class="line">修改目录权限</span><br><span class="line">[root@web joomla]<span class="comment"># cd ..</span></span><br><span class="line">[root@web html]<span class="comment"># chown -R apache:apache joomla/</span></span><br></pre></td></tr></table></figure>

<p>2、测试服务器访问</p>
<p>打开已经安装的软件会自动进入自动配置流程：<br>打开网站：<a href="http://121.36.210.29/joomla/" target="_blank" rel="noopener">http://121.36.210.29/joomla/</a></p>
<p>3、增加简体中文-部署完成</p>
<p>Extensions: Install Languages<br>选择：Chinese Simplified</p>
<h2 id="三、部署Drupal-CMS开源内容管理"><a href="#三、部署Drupal-CMS开源内容管理" class="headerlink" title="三、部署Drupal CMS开源内容管理"></a>三、部署Drupal CMS开源内容管理</h2><p>Drupal是全球三大开源内容管理系统之一。<br><a href="http://down.chinaz.com/try/201205/1892_1.htm" target="_blank" rel="noopener">http://down.chinaz.com/try/201205/1892_1.htm</a></p>
<p>1、下载Drupal软件<br>官方网站：<a href="https://www.joomla.org/" target="_blank" rel="noopener">https://www.joomla.org/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@web html]<span class="comment"># cd /var/www/html/</span></span><br><span class="line">[root@web drupal]<span class="comment"># wget https://ftp.drupal.org/files/projects/drupal-8.8.3.zip</span></span><br><span class="line">or</span><br><span class="line">[root@web drupal]<span class="comment"># wget https://ftp.drupal.org/files/projects/drupal-8.8.3.tar.gz</span></span><br><span class="line"></span><br><span class="line">解压软件：</span><br><span class="line">[root@web html]<span class="comment"># tar -zxvf drupal-8.8.3.tar.gz</span></span><br><span class="line">修改目录权限</span><br><span class="line">[root@web html]<span class="comment"># chown -R apache:apache drupal-8.8.3/</span></span><br></pre></td></tr></table></figure>

<p>配置PHP环境：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@web ~]<span class="comment"># vim /usr/local/php/etc/php.ini</span></span><br><span class="line">将max_execution_time = 30 </span><br><span class="line">改成max_execution_time = 90</span><br><span class="line">[opcache]</span><br><span class="line">engine = On</span><br><span class="line">;zend_extension=php_opcache.dll</span><br><span class="line">zend_extension=/usr/<span class="built_in">local</span>/src/php-7.3.15/modules/opcache.so</span><br><span class="line">opcache.enable=1</span><br><span class="line">opcache.memory_consumption=128</span><br><span class="line">opcache.interned_strings_buffer=8</span><br><span class="line">opcache.max_accelerated_files=4000</span><br><span class="line">opcache.revalidate_freq=60</span><br><span class="line">opcache.fast_shutdown=1</span><br></pre></td></tr></table></figure>

<p>2、创建Drupal数据库</p>
<p>连接到MYSQL数据库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@web ~]# mysql -u root -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 17</span><br><span class="line">Server version: 5.7.27 Source distribution</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE DATABASE drupaldb;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>3、测试服务器是否可以访问</p>
<p>打开已经安装的软件会自动进入自动配置流程：<br>打开网站：<a href="http://192.169.19.135/drupal-8.8.3/core/install.php" target="_blank" rel="noopener">http://192.169.19.135/drupal-8.8.3/core/install.php</a></p>
<p>网站打开后，可能会出现错误提示：<br>Warnings found</p>
<blockquote>
<p>PHP OPCODE CACHING<br>Not enabled<br>PHP OPcode caching can improve your site’s performance considerably. It is highly recommended to have OPcache installed on your server.</p>
</blockquote>
<p><strong>错误原因是：缺少PHP OPcod</strong><br>opcache是用来提高PHP性能的，Opcache 的前生是 Optimizer+ ，它是PHP的官方公司 Zend 开发的一款闭源但可以免费使用的 PHP 优化加速组件。“鸟哥在博客中说，提高PHP 7性能的几个tips，第一条就是开启opcache”</p>
<p>在文件的1912行下面增加下列代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@web ~]<span class="comment"># vim /usr/local/php/etc/php.ini</span></span><br><span class="line">将max_execution_time = 30 </span><br><span class="line">改成max_execution_time = 90</span><br><span class="line"></span><br><span class="line">[opcache]</span><br><span class="line">engine = On</span><br><span class="line">;zend_extension=php_opcache.dll</span><br><span class="line">zend_extension=/usr/<span class="built_in">local</span>/src/php-7.3.15/modules/opcache.so</span><br><span class="line">opcache.enable=1</span><br><span class="line">opcache.memory_consumption=128</span><br><span class="line">opcache.interned_strings_buffer=8</span><br><span class="line">opcache.max_accelerated_files=4000</span><br><span class="line">opcache.revalidate_freq=60</span><br><span class="line">opcache.fast_shutdown=1</span><br></pre></td></tr></table></figure>

<p>4、部署完成<br>打开地址<br><a href="http://192.169.19.135/drupal-8.8.3" target="_blank" rel="noopener">http://192.169.19.135/drupal-8.8.3</a><br>访问。</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://majunbo.top/20200509/kunpeng05-phpcms/" data-id="ckado7uf30000819x7jya3fpy" class="article-share-link">分享到</a>
      

      

      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kunpeng/" rel="tag">kunpeng</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-kunpeng04-php" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20200508/kunpeng04-php/" class="article-date">
  <time datetime="2020-05-08T15:13:20.000Z" itemprop="datePublished">2020-05-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20200508/kunpeng04-php/">鲲鹏服务器实验四：PHP7编译安装</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>PHP官方网站: <a href="https://www.php.net/" target="_blank" rel="noopener">https://www.php.net/</a></p>
<p>截至2020年2月，最新稳定版本为7.4.3，我们编译上一个稳定版本：PHP 7.3.15</p>
<h2 id="一、准备华为鲲鹏服务器，安装http服务器"><a href="#一、准备华为鲲鹏服务器，安装http服务器" class="headerlink" title="一、准备华为鲲鹏服务器，安装http服务器"></a>一、准备华为鲲鹏服务器，安装http服务器</h2><p>使用已经有新版GCC的鲲鹏服务器(实验一中的环境)，版本为7.3以上，官网为：<a href="https://gcc.gnu.org/" target="_blank" rel="noopener">https://gcc.gnu.org/</a></p>
<p>CentOS7系统安装Apache\nginx WEB服务器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y httpd</span><br></pre></td></tr></table></figure>
<p>启动并测试服务器是否可以访问：<a href="http://192.169.19.135/" target="_blank" rel="noopener">http://192.169.19.135/</a></p>
<p>如果不可以访问，可关闭防火墙，或者添加80端口：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@web var]<span class="comment"># firewall-cmd --state</span></span><br><span class="line">running</span><br><span class="line">[root@web var]<span class="comment"># systemctl status firewalld.service </span></span><br><span class="line">● firewalld.service - firewalld - dynamic firewall daemon</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Mon 2020-03-09 10:54:23 CST; 6min ago</span><br><span class="line">     Docs: man:firewalld(1)</span><br><span class="line"> Main PID: 1190 (firewalld)</span><br><span class="line">   CGroup: /system.slice/firewalld.service</span><br><span class="line">           └─1190 /usr/bin/python2 -Es /usr/sbin/firewalld --nofork --nopid</span><br><span class="line"></span><br><span class="line">Mar 09 10:54:22 localhost.localdomain systemd[1]: Starting firewalld - dynamic firewall daemon...</span><br><span class="line">Mar 09 10:54:23 localhost.localdomain systemd[1]: Started firewalld - dynamic firewall daemon.</span><br><span class="line"></span><br><span class="line">[root@web var]<span class="comment"># systemctl stop firewalld.service</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁止自动启动：</span></span><br><span class="line">[root@web var]<span class="comment"># systemctl disable firewalld.service </span></span><br><span class="line">Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.</span><br><span class="line">Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者增加防火墙端口</span></span><br><span class="line">[root@web var]<span class="comment">#  firewall-cmd --zone=public --add-port=80/tcp --permanent</span></span><br><span class="line">success</span><br><span class="line"><span class="comment"># 重启防火墙：</span></span><br><span class="line">[root@web var]<span class="comment"># firewall-cmd --reload</span></span><br><span class="line">success</span><br><span class="line">[root@web var]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="二、检查当前系统PHP版本"><a href="#二、检查当前系统PHP版本" class="headerlink" title="二、检查当前系统PHP版本"></a>二、检查当前系统PHP版本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-web ~]<span class="comment"># php --version</span></span><br><span class="line">-bash: php: <span class="built_in">command</span> not found</span><br><span class="line"></span><br><span class="line">系统自带PHP为5.4，</span><br><span class="line">[root@web ~]<span class="comment"># yum list|grep php</span></span><br><span class="line">emacs-php-mode.noarch                       1.18.2-1.el7               base     </span><br><span class="line">graphviz-php.aarch64                        2.30.1-21.el7              base     </span><br><span class="line">php.aarch64                                 5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-bcmath.aarch64                          5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-cli.aarch64                             5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-common.aarch64                          5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-dba.aarch64                             5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-devel.aarch64                           5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-embedded.aarch64                        5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-enchant.aarch64                         5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-fpm.aarch64                             5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-gd.aarch64                              5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-intl.aarch64                            5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-ldap.aarch64                            5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-mbstring.aarch64                        5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-mysql.aarch64                           5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-mysqlnd.aarch64                         5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-odbc.aarch64                            5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-pdo.aarch64                             5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-pear.noarch                             1:1.9.4-21.el7             base     </span><br><span class="line">php-pecl-memcache.aarch64                   3.0.8-4.el7                base     </span><br><span class="line">php-pgsql.aarch64                           5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-process.aarch64                         5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-pspell.aarch64                          5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-recode.aarch64                          5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-snmp.aarch64                            5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-soap.aarch64                            5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-xml.aarch64                             5.4.16-46.1.el7_7          updates  </span><br><span class="line">php-xmlrpc.aarch64                          5.4.16-46.1.el7_7          updates  </span><br><span class="line">rrdtool-php.aarch64                         1.4.8-9.el7                base     </span><br><span class="line">uuid-php.aarch64                            1.6.2-26.el7               base     </span><br><span class="line">[root@web ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="三、配置安装环境"><a href="#三、配置安装环境" class="headerlink" title="三、配置安装环境"></a>三、配置安装环境</h2><p>1、安装依赖包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install libxml2-devel openssl openssl-devel curl curl-devel libjpeg libjpeg-devel freetype freetype-devel libpng libpng-devel libxslt libxslt-devel pcre pcre-devel bzip2 bzip2-devel</span><br><span class="line"></span><br><span class="line">yum install httpd-devel.aarch64</span><br></pre></td></tr></table></figure>

<p>准备libzip，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@web ~]<span class="comment"># cd /opt</span></span><br><span class="line">[root@web ~]<span class="comment"># wget https://libzip.org/download/libzip-1.5.1.tar.gz</span></span><br><span class="line">tar -zxvf libzip-1.5.1.tar.gz</span><br><span class="line"><span class="built_in">cd</span> libzip-1.5.1</span><br><span class="line">mkdir build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake ..</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">make -j8 &amp;&amp; make install</span><br><span class="line"></span><br><span class="line">配置变量：</span><br><span class="line"><span class="comment"># 添加搜索路径到配置文件</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'/usr/local/lib64</span></span><br><span class="line"><span class="string">/usr/local/lib</span></span><br><span class="line"><span class="string">/usr/lib</span></span><br><span class="line"><span class="string">/usr/lib64'</span>&gt;&gt;/etc/ld.so.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新配置</span></span><br><span class="line">ldconfig -v</span><br></pre></td></tr></table></figure>
<div style="page-break-after:always;"></div>
2、下载PHP7至/opt 目录下并解压

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/</span><br><span class="line">wget https://www.php.net/distributions/php-7.3.15.tar.gz</span><br><span class="line">tar -zxvf php-7.3.15.tar.gz</span><br><span class="line"><span class="built_in">cd</span> php-7.3.15</span><br><span class="line"></span><br><span class="line">./configure \</span><br><span class="line">    --prefix=/usr/<span class="built_in">local</span>/php \</span><br><span class="line">    --<span class="built_in">exec</span>-prefix=/usr/<span class="built_in">local</span>/php \</span><br><span class="line">    --bindir=/usr/<span class="built_in">local</span>/php/bin \</span><br><span class="line">    --sbindir=/usr/<span class="built_in">local</span>/php/sbin \</span><br><span class="line">    --includedir=/usr/<span class="built_in">local</span>/php/include \</span><br><span class="line">    --libdir=/usr/<span class="built_in">local</span>/php/lib/php \</span><br><span class="line">    --mandir=/usr/<span class="built_in">local</span>/php/php/man \</span><br><span class="line">    --with-config-file-path=/usr/<span class="built_in">local</span>/php/etc \</span><br><span class="line">    --with-mysql-sock=/var/lib/mysql/mysql.sock \</span><br><span class="line">    --with-mhash \</span><br><span class="line">    --with-openssl \</span><br><span class="line">    --with-mysqli=shared,mysqlnd \</span><br><span class="line">    --with-pdo-mysql=shared,mysqlnd \</span><br><span class="line">    --with-gd \</span><br><span class="line">    --with-jpeg-dir \</span><br><span class="line">    --with-png-dir \</span><br><span class="line">    --with-iconv \</span><br><span class="line">    --with-zlib \</span><br><span class="line">    --<span class="built_in">enable</span>-zip \</span><br><span class="line">    --<span class="built_in">enable</span>-inline-optimization \</span><br><span class="line">    --<span class="built_in">disable</span>-debug \</span><br><span class="line">    --<span class="built_in">disable</span>-rpath \</span><br><span class="line">    --<span class="built_in">enable</span>-shared \</span><br><span class="line">    --<span class="built_in">enable</span>-xml \</span><br><span class="line">    --<span class="built_in">enable</span>-bcmath \</span><br><span class="line">    --<span class="built_in">enable</span>-shmop \</span><br><span class="line">    --<span class="built_in">enable</span>-sysvsem \</span><br><span class="line">    --<span class="built_in">enable</span>-mbregex \</span><br><span class="line">    --<span class="built_in">enable</span>-mbstring \</span><br><span class="line">    --<span class="built_in">enable</span>-ftp \</span><br><span class="line">    --<span class="built_in">enable</span>-pcntl \</span><br><span class="line">    --<span class="built_in">enable</span>-sockets \</span><br><span class="line">    --with-xmlrpc \</span><br><span class="line">    --<span class="built_in">enable</span>-soap \</span><br><span class="line">    --without-pear \</span><br><span class="line">    --with-gettext \</span><br><span class="line">    --<span class="built_in">enable</span>-session \</span><br><span class="line">    --with-curl \</span><br><span class="line">    --with-freetype-dir \</span><br><span class="line">    --<span class="built_in">enable</span>-opcache \</span><br><span class="line">    --<span class="built_in">enable</span>-fpm \</span><br><span class="line">    --with-fpm-user=www \</span><br><span class="line">    --with-fpm-group=www \</span><br><span class="line">    --without-gdbm \</span><br><span class="line">    --<span class="built_in">enable</span>-fileinfo \</span><br><span class="line">    --with-apxs2=/usr/bin/apxs</span><br><span class="line">    </span><br><span class="line">    --<span class="built_in">disable</span>-fileinfo</span><br></pre></td></tr></table></figure>

<p>执行的结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">checking whether stripping libraries is possible... yes</span><br><span class="line">checking <span class="keyword">if</span> libtool supports shared libraries... yes</span><br><span class="line">checking whether to build shared libraries... yes</span><br><span class="line">checking whether to build static libraries... no</span><br><span class="line"></span><br><span class="line">creating libtool</span><br><span class="line">appending configuration tag <span class="string">"CXX"</span> to libtool</span><br><span class="line"></span><br><span class="line">Generating files</span><br><span class="line">configure: creating ./config.status</span><br><span class="line">creating main/internal_functions.c</span><br><span class="line">creating main/internal_functions_cli.c</span><br><span class="line">+--------------------------------------------------------------------+</span><br><span class="line">|                        *** WARNING ***                             |</span><br><span class="line">|                                                                    |</span><br><span class="line">| You have built PHP <span class="keyword">for</span> Apache<span class="string">'s current non-threaded MPM.          |</span></span><br><span class="line"><span class="string">| If you change Apache to use a threaded MPM you must reconfigure    |</span></span><br><span class="line"><span class="string">| PHP with --enable-maintainer-zts                                   |</span></span><br><span class="line"><span class="string">+--------------------------------------------------------------------+</span></span><br><span class="line"><span class="string">| License:                                                           |</span></span><br><span class="line"><span class="string">| This software is subject to the PHP License, available in this     |</span></span><br><span class="line"><span class="string">| distribution in the file LICENSE.  By continuing this installation |</span></span><br><span class="line"><span class="string">| process, you are bound by the terms of this license agreement.     |</span></span><br><span class="line"><span class="string">| If you do not agree with the terms of this license, you must abort |</span></span><br><span class="line"><span class="string">| the installation process at this point.                            |</span></span><br><span class="line"><span class="string">+--------------------------------------------------------------------+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Thank you for using PHP.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">config.status: creating php7.spec</span></span><br><span class="line"><span class="string">config.status: creating main/build-defs.h</span></span><br><span class="line"><span class="string">config.status: creating scripts/phpize</span></span><br><span class="line"><span class="string">config.status: creating scripts/man1/phpize.1</span></span><br><span class="line"><span class="string">config.status: creating scripts/php-config</span></span><br><span class="line"><span class="string">config.status: creating scripts/man1/php-config.1</span></span><br><span class="line"><span class="string">config.status: creating sapi/cli/php.1</span></span><br><span class="line"><span class="string">config.status: creating sapi/fpm/php-fpm.conf</span></span><br><span class="line"><span class="string">config.status: creating sapi/fpm/www.conf</span></span><br><span class="line"><span class="string">config.status: creating sapi/fpm/init.d.php-fpm</span></span><br><span class="line"><span class="string">config.status: creating sapi/fpm/php-fpm.service</span></span><br><span class="line"><span class="string">config.status: creating sapi/fpm/php-fpm.8</span></span><br><span class="line"><span class="string">config.status: creating sapi/fpm/status.html</span></span><br><span class="line"><span class="string">config.status: creating sapi/phpdbg/phpdbg.1</span></span><br><span class="line"><span class="string">config.status: creating sapi/cgi/php-cgi.1</span></span><br><span class="line"><span class="string">config.status: creating ext/phar/phar.1</span></span><br><span class="line"><span class="string">config.status: creating ext/phar/phar.phar.1</span></span><br><span class="line"><span class="string">config.status: creating main/php_config.h</span></span><br><span class="line"><span class="string">config.status: executing default commands</span></span><br><span class="line"><span class="string">[root@ecs-web php-7.3.15]#</span></span><br></pre></td></tr></table></figure>

<h2 id="四、编译安装"><a href="#四、编译安装" class="headerlink" title="四、编译安装"></a>四、编译安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">检测CPU数量：</span><br><span class="line">cat /proc/cpuinfo| grep <span class="string">"processor"</span>| wc -l</span><br><span class="line"></span><br><span class="line">make -j[后跟CPU数量] &amp;&amp; make install</span><br><span class="line">make -j8 &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>编译结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">invertedregexiterator.inc</span><br><span class="line">phar.inc</span><br><span class="line"></span><br><span class="line">Build complete.</span><br><span class="line">Don<span class="string">'t forget to run '</span>make <span class="built_in">test</span><span class="string">'.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Installing PHP SAPI module:       apache2handler</span></span><br><span class="line"><span class="string">/usr/lib64/httpd/build/instdso.sh SH_LIBTOOL='</span>/usr/lib64/apr-1/build/libtool<span class="string">' libphp7.la /usr/lib64/httpd/modules</span></span><br><span class="line"><span class="string">/usr/lib64/apr-1/build/libtool --mode=install install libphp7.la /usr/lib64/httpd/modules/</span></span><br><span class="line"><span class="string">libtool: install: install .libs/libphp7.so /usr/lib64/httpd/modules/libphp7.so</span></span><br><span class="line"><span class="string">libtool: install: install .libs/libphp7.lai /usr/lib64/httpd/modules/libphp7.la</span></span><br><span class="line"><span class="string">libtool: install: warning: remember to run `libtool --finish /usr/local/src/php-7.3.15/libs'</span></span><br><span class="line">chmod 755 /usr/lib64/httpd/modules/libphp7.so</span><br><span class="line">[activating module `php7<span class="string">' in /etc/httpd/conf/httpd.conf]</span></span><br><span class="line"><span class="string">Installing shared extensions:     /usr/local/php/lib/php/extensions/no-debug-non-zts-20180731/</span></span><br><span class="line"><span class="string">Installing PHP CLI binary:        /usr/local/php/bin/</span></span><br><span class="line"><span class="string">Installing PHP CLI man page:      /usr/local/php/php/man/man1/</span></span><br><span class="line"><span class="string">Installing PHP FPM binary:        /usr/local/php/sbin/</span></span><br><span class="line"><span class="string">Installing PHP FPM defconfig:     /usr/local/php/etc/</span></span><br><span class="line"><span class="string">Installing PHP FPM man page:      /usr/local/php/php/man/man8/</span></span><br><span class="line"><span class="string">Installing PHP FPM status page:   /usr/local/php/php/php/fpm/</span></span><br><span class="line"><span class="string">Installing phpdbg binary:         /usr/local/php/bin/</span></span><br><span class="line"><span class="string">Installing phpdbg man page:       /usr/local/php/php/man/man1/</span></span><br><span class="line"><span class="string">Installing PHP CGI binary:        /usr/local/php/bin/</span></span><br><span class="line"><span class="string">Installing PHP CGI man page:      /usr/local/php/php/man/man1/</span></span><br><span class="line"><span class="string">Installing build environment:     /usr/local/php/lib/php/build/</span></span><br><span class="line"><span class="string">Installing header files:          /usr/local/php/include/php/</span></span><br><span class="line"><span class="string">Installing helper programs:       /usr/local/php/bin/</span></span><br><span class="line"><span class="string">  program: phpize</span></span><br><span class="line"><span class="string">  program: php-config</span></span><br><span class="line"><span class="string">Installing man pages:             /usr/local/php/php/man/man1/</span></span><br><span class="line"><span class="string">  page: phpize.1</span></span><br><span class="line"><span class="string">  page: php-config.1</span></span><br><span class="line"><span class="string">/usr/local/src/php-7.3.15/build/shtool install -c ext/phar/phar.phar /usr/local/php/bin</span></span><br><span class="line"><span class="string">ln -s -f phar.phar /usr/local/php/bin/phar</span></span><br><span class="line"><span class="string">Installing PDO headers:           /usr/local/php/include/php/ext/pdo/</span></span><br><span class="line"><span class="string">[root@ecs-web php-7.3.15]#</span></span><br></pre></td></tr></table></figure>

<h2 id="五、安装完成"><a href="#五、安装完成" class="headerlink" title="五、安装完成"></a>五、安装完成</h2><p>1、建立软链接：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/<span class="built_in">local</span>/php/sbin/php-fpm /usr/<span class="built_in">local</span>/bin</span><br><span class="line">ln -s /usr/<span class="built_in">local</span>/php/bin/php /usr/bin/php</span><br></pre></td></tr></table></figure>

<p>2、执行结果，查看版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-web php-7.3.15]<span class="comment"># ln -s /usr/local/php/sbin/php-fpm /usr/local/bin</span></span><br><span class="line">[root@ecs-web php-7.3.15]<span class="comment"># ln -s /usr/local/php/bin/php /usr/bin/php</span></span><br><span class="line"><span class="comment"># 查看版本：</span></span><br><span class="line">[root@ecs-web php-7.3.15]<span class="comment"># php -v</span></span><br><span class="line">PHP 7.3.15 (cli) (built: Mar  7 2020 19:47:46) ( NTS )</span><br><span class="line">Copyright (c) 1997-2018 The PHP Group</span><br><span class="line">Zend Engine v3.3.15, Copyright (c) 1998-2018 Zend Technologies</span><br><span class="line">[root@ecs-web php-7.3.15]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h2 id="六、配置Apache识别PHP"><a href="#六、配置Apache识别PHP" class="headerlink" title="六、配置Apache识别PHP"></a>六、配置Apache识别PHP</h2><p>1、生成php-fpm配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">拷贝一个php-fpm.conf文件</span><br><span class="line">[root@web html]<span class="comment"># cd /usr/local/php/etc</span></span><br><span class="line">[root@web html]<span class="comment"># cp php-fpm.conf.default php-fpm.conf</span></span><br><span class="line">[root@web etc]<span class="comment"># cd /usr/local/php/etc/php-fpm.d</span></span><br><span class="line">[root@web php-fpm.d]<span class="comment"># cp www.conf.default www.conf</span></span><br></pre></td></tr></table></figure>

<p>2、生成<a href="http://www.conf配置文件" target="_blank" rel="noopener">www.conf配置文件</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@web etc]<span class="comment"># cd /usr/local/php/etc/php-fpm.d</span></span><br><span class="line">[root@web php-fpm.d]<span class="comment"># pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/php/etc/php-fpm.d</span><br><span class="line">[root@web php-fpm.d]<span class="comment"># vim www.conf</span></span><br><span class="line">change this :</span><br><span class="line">user = www</span><br><span class="line">group = www</span><br><span class="line">to :</span><br><span class="line">user = apache</span><br><span class="line">group = apache</span><br><span class="line"></span><br><span class="line">启动php-fpm</span><br><span class="line">[root@web php-fpm.d]<span class="comment"># php-fpm </span></span><br><span class="line">[root@web php-fpm.d]<span class="comment"># ps -ef|grep php-fpm</span></span><br><span class="line">root     23196     1  0 11:44 ?        00:00:00 php-fpm: master process (/usr/<span class="built_in">local</span>/php/etc/php-fpm.conf)</span><br><span class="line">apache   23197 23196  0 11:44 ?        00:00:00 php-fpm: pool www</span><br><span class="line">apache   23198 23196  0 11:44 ?        00:00:00 php-fpm: pool www</span><br><span class="line">root     23200  2659  0 11:44 pts/0    00:00:00 grep --color=auto php-fpm</span><br><span class="line">[root@web php-fpm.d]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>3、生成php.ini文件<br>在/usr/local/src/php-7.3.15/目录中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@web php-fpm.d]<span class="comment"># cp /usr/local/src/php-7.3.15/php.ini-production /usr/local/php/etc/php.ini</span></span><br><span class="line">[root@web php-fpm.d]<span class="comment"># vim /usr/local/php/etc/php.ini</span></span><br><span class="line"><span class="comment"># change this (890行):</span></span><br><span class="line">;extension=mysqli</span><br><span class="line"><span class="comment"># to this:</span></span><br><span class="line">extension=mysqli</span><br></pre></td></tr></table></figure>

<p>4、编辑：/etc/httpd/conf/httpd.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@web /]<span class="comment"># vim /etc/httpd/conf/httpd.conf</span></span><br><span class="line"><span class="comment"># 在55行下增加如下信息：</span></span><br><span class="line">LoadModule php7_module /usr/lib64/httpd/modules/libphp7.so</span><br><span class="line">//或者</span><br><span class="line">LoadModule php7_module modules/libphp7.so</span><br><span class="line"></span><br><span class="line">AddType application/x-httpd-php .php</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改下列代码，支持WEB访问（可选）：</span></span><br><span class="line">&lt;Directory <span class="string">"/var/www/html"</span>&gt;</span><br><span class="line">  </span><br><span class="line">    AllowOverride All</span><br><span class="line">    Require all granted</span><br><span class="line">    Options Indexes FollowSymLinks Includes ExecCGI</span><br><span class="line"></span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;IfModule dir_module&gt;</span><br><span class="line">    DirectoryIndex index.php index.html</span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>
<p>5、编辑一个PHP信息文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@web html]<span class="comment"># cd /var/www/html/</span></span><br><span class="line">[root@web html]<span class="comment"># vim index.php</span></span><br><span class="line">&lt;?php</span><br><span class="line">phpinfo();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>6、重新启动httpd并测试访问</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@web html]<span class="comment"># systemctl restart httpd.service</span></span><br></pre></td></tr></table></figure>

<p>打开浏览器：<br><a href="http://192.169.19.135/" target="_blank" rel="noopener">http://192.169.19.135/</a></p>
<p>是否显示为：PHP Version 7.3.15</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://majunbo.top/20200508/kunpeng04-php/" data-id="ckadngvs100006e9xhha1br0w" class="article-share-link">分享到</a>
      

      

      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kunpeng/" rel="tag">kunpeng</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-kunpeng03-mysql8" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20200507/kunpeng03-mysql8/" class="article-date">
  <time datetime="2020-05-07T14:04:12.000Z" itemprop="datePublished">2020-05-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20200507/kunpeng03-mysql8/">鲲鹏服务器实验三：MySQL8 yum安装</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>准备好鲲鹏服务器，连上互联网：</p>
<h2 id="一、安装MySQL8"><a href="#一、安装MySQL8" class="headerlink" title="一、安装MySQL8"></a>一、安装MySQL8</h2><p>Step 1: 下载仓库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>Step 2: 添加yum仓库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm –ivh mysql80-community-release-el7-3.noarch.rpm</span><br></pre></td></tr></table></figure>

<p>或者手动编辑mysql.repo文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d/</span><br><span class="line">vim mysql.repo</span><br><span class="line"></span><br><span class="line"><span class="comment">#放入下面内容：</span></span><br><span class="line">[mysql]</span><br><span class="line">name=mysql</span><br><span class="line">baseurl=http://repo.mysql.com/yum/mysql-8.0-community/el/7/aarch64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br></pre></td></tr></table></figure>

<p>Step 3: 安装MySQL</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql-server</span><br></pre></td></tr></table></figure>

<h2 id="二、使用MySQL8"><a href="#二、使用MySQL8" class="headerlink" title="二、使用MySQL8"></a>二、使用MySQL8</h2><p>1、启动、停止数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mysqld</span><br><span class="line">systemctl stop mysqld</span><br></pre></td></tr></table></figure>

<p>2、查看状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status mysqld</span><br></pre></td></tr></table></figure>

<p>3、开启、禁止数据库自动启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">disable</span> mysqld</span><br><span class="line">systemctl <span class="built_in">enable</span> mysqld</span><br></pre></td></tr></table></figure>

<p>4、查找安装时root的临时密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">'temporary password'</span> /var/<span class="built_in">log</span>/mysqld.log</span><br><span class="line"></span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># grep 'temporary password' /var/log/mysqld.log</span></span><br><span class="line">2020-03-06T15:19:08.425969Z 5 [Note] [MY-010454] [Server] A temporary password is generated <span class="keyword">for</span> root@localhost: ;-2Vph79h;m/</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>5、登录数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql –u root –p</span><br><span class="line">必须修改密码：</span><br><span class="line">ALTER USER USER() IDENTIFIED BY &#39;123456&#39;;</span><br><span class="line">退出重新登录即可。</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://majunbo.top/20200507/kunpeng03-mysql8/" data-id="ckadmu42l00003y9x67oh1aon" class="article-share-link">分享到</a>
      

      

      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kunpeng/" rel="tag">kunpeng</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-kunpeng02-mysql5" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20200506/kunpeng02-mysql5/" class="article-date">
  <time datetime="2020-05-06T13:49:52.000Z" itemprop="datePublished">2020-05-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20200506/kunpeng02-mysql5/">鲲鹏服务器实验二：MySQL5.X 编译安装</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一、安装依赖"><a href="#一、安装依赖" class="headerlink" title="一、安装依赖"></a>一、安装依赖</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install -y bison* ncurses* openssl-devel cmake</span><br><span class="line"><span class="comment"># or 安装完成后手贡编译新版本的cmake</span></span><br><span class="line">yum install -y bison* ncurses* openssl-devel bzip2 wget</span><br></pre></td></tr></table></figure>

<p>CMake是一个跨平台的安装/编译工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src</span><br><span class="line">wget https://cmake.org/files/v3.9/cmake-3.9.2.tar.gz</span><br><span class="line">tar -zxvf cmake-3.9.2.tar.gz</span><br><span class="line"><span class="built_in">cd</span> cmake-3.9.2</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">or:</span><br><span class="line">make -j8</span><br><span class="line">make install</span><br><span class="line">检查版本：</span><br><span class="line">cmake -version</span><br></pre></td></tr></table></figure>
<p>大数据需要cmake3.1.2以上：</p>
<blockquote>
<p><a href="https://bbs.huaweicloud.com/forum/thread-42909-1-1.html" target="_blank" rel="noopener">https://bbs.huaweicloud.com/forum/thread-42909-1-1.html</a><br>baidu网盘cmake等资料下载<br><a href="https://pan.baidu.com/s/1gb86Uyt1fNm5wUbQuDGzyw" target="_blank" rel="noopener">https://pan.baidu.com/s/1gb86Uyt1fNm5wUbQuDGzyw</a><br>s19a</p>
</blockquote>
<h2 id="二、获取源码"><a href="#二、获取源码" class="headerlink" title="二、获取源码"></a>二、获取源码</h2><p>MySQL源码包版本为“5.x.x”则必须为5.7.27以上，版本为“8.x.x”的则必须为8.0.17以上，否则需要安装另外的补丁。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line"></span><br><span class="line">5.7.27版本下载地址：</span><br><span class="line">wget https://kunpengsoft.obs.cn-north-4.myhuaweicloud.com/mysql-5.7.27.tar.gz</span><br><span class="line">5.7.29版本下载地址：</span><br><span class="line">wget https://cdn.mysql.com//Downloads/MySQL-5.7/mysql-5.7.29.tar.gz</span><br><span class="line"></span><br><span class="line">Boost C++ 库工具下载</span><br><span class="line">wget https://kunpengsoft.obs.cn-north-4.myhuaweicloud.com/boost_1_59_0.tar.gz</span><br><span class="line"></span><br><span class="line">MYSQL官网地址：</span><br><span class="line">https://dev.mysql.com/downloads/mysql/5.7.html<span class="comment">#downloads</span></span><br></pre></td></tr></table></figure>

<h2 id="三、编译和安装"><a href="#三、编译和安装" class="headerlink" title="三、编译和安装"></a>三、编译和安装</h2><ol>
<li><p>解压软件包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf mysql-5.7.27.tar.gz</span><br><span class="line">tar -zxvf boost_1_59_0.tar.gz</span><br></pre></td></tr></table></figure>
</li>
<li><p>进入 MySQL 的安装目录，创建并编辑 cmake.sh 文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> mysql-5.7.27</span><br><span class="line">vim cmake.sh</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>文件内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cmake . -DCMAKE_INSTALL_PREFIX=/usr/<span class="built_in">local</span>/mysql \</span><br><span class="line">-DMYSQL_DATADIR=/usr/<span class="built_in">local</span>/mysql/data \</span><br><span class="line">-DSYSCONFDIR=/etc \</span><br><span class="line">-DWITH_INNOBASE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_PARTITION_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_FEDERATED_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \</span><br><span class="line">-DWITH_MYISAM_STORAGE_ENGINE=1 \</span><br><span class="line">-DENABLED_LOCAL_INFILE=1 \</span><br><span class="line">-DENABLE_DTRACE=0 \</span><br><span class="line">-DDEFAULT_CHARSET=utf8mb4 \</span><br><span class="line">-DDEFAULT_COLLATION=utf8mb4_general_ci \</span><br><span class="line">-DWITH_EMBEDDED_SERVER=1 \</span><br><span class="line">-DDOWNLOAD_BOOST=1 \</span><br><span class="line">-DWITH_BOOST=/opt/boost_1_59_0</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>给”cmake.sh”赋以权限并运行，等待运行完成<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x cmake.sh</span><br><span class="line">./cmake.sh</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>备注：若在预编译时出现依赖包不全的情况，可自行查阅资料安装依赖包，并重新预编译。重新预编译前，需要删除”CMakeCache.txt”文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -f CMakeCache.txt</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在 MySQL 源码路径下执行 make 命令，等待编译完成<br>开始编译：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-kp01 mysql-5.7.27]<span class="comment"># pwd</span></span><br><span class="line">/opt/mysql-5.7.27</span><br><span class="line">[root@ecs-kp01 mysql-5.7.27]<span class="comment"># make -j`cat /proc/cpuinfo| grep "processor"| wc -l`</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>直接编译会出错（CentOS7.6 1810 mysql5.7）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[ 97%] Building CXX object sql/CMakeFiles/sql.dir/signal_handler.cc.o</span><br><span class="line">[ 98%] Building CXX object sql/CMakeFiles/sql.dir/sql_audit.cc.o</span><br><span class="line">[ 98%] Building CXX object sql/CMakeFiles/sql.dir/sql_client.cc.o</span><br><span class="line">[ 98%] Building CXX object sql/CMakeFiles/sql.dir/srv_session.cc.o</span><br><span class="line">[ 98%] Building CXX object sql/CMakeFiles/sql.dir/srv_session_info_service.cc.o</span><br><span class="line">/opt/mysql-5.7.27/sql/mysqld.cc: In <span class="keyword">function</span> ‘passwd* check_user(const char*)’:</span><br><span class="line">/opt/mysql-5.7.27/sql/mysqld.cc:1558:12: error: ‘prctl’ was not declared <span class="keyword">in</span> this scope</span><br><span class="line">     (void) prctl(PR_SET_DUMPABLE, 1);</span><br><span class="line">            ^~~~~</span><br><span class="line">[ 98%] Building CXX object sql/CMakeFiles/sql.dir/srv_session_service.cc.o</span><br><span class="line">[ 98%] Building CXX object sql/CMakeFiles/sql.dir/auth/sha2_password_common.cc.o</span><br><span class="line">make[2]: *** [sql/CMakeFiles/sql.dir/mysqld.cc.o] Error 1</span><br><span class="line">make[2]: *** Waiting <span class="keyword">for</span> unfinished <span class="built_in">jobs</span>....</span><br><span class="line">make[1]: *** [sql/CMakeFiles/sql.dir/all] Error 2</span><br><span class="line">make: *** [all] Error 2</span><br></pre></td></tr></table></figure>

<p>错误说明：<br><a href="https://bugs.mysql.com/bug.php?id=90642" target="_blank" rel="noopener">https://bugs.mysql.com/bug.php?id=90642</a><br><a href="https://bbs.huaweicloud.com/ask/1573525839645530" target="_blank" rel="noopener">https://bbs.huaweicloud.com/ask/1573525839645530</a><br><a href="https://bugs.mysql.com/bug.php?id=84495" target="_blank" rel="noopener">https://bugs.mysql.com/bug.php?id=84495</a></p>
<p>以上错误是代码有问题，这是MySQL bug：</p>
<p>解决方案：1）增加代码-荐（MYSQL官方解决方案）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/mysql-5.7.27/sql/mysqld.cc</span><br><span class="line">增加下面代码</span><br><span class="line"><span class="meta">#</span><span class="bash">include &lt;sys/prctl.h&gt;</span></span><br></pre></td></tr></table></figure>

<p>解决方案：2）注释代码（华为云网友解决方案）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/mysql-5.7.27/sql/mysqld.cc</span><br><span class="line">/*(void) prctl(PR_SET_DUMPABLE, 1);*/</span><br></pre></td></tr></table></figure>
<p>注释或是增加代码后再次编译：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[ 99%] Building CXX object sql/CMakeFiles/sql.dir/mf_iocache.cc.o</span><br><span class="line">[ 99%] Building CXX object sql/CMakeFiles/sql.dir/mysqld.cc.o</span><br><span class="line">[100%] Building CXX object sql/CMakeFiles/sql.dir/mysqld_thd_manager.cc.o</span><br><span class="line">[100%] Building CXX object sql/CMakeFiles/sql.dir/protocol_callback.cc.o</span><br><span class="line">[100%] Building CXX object sql/CMakeFiles/sql.dir/signal_handler.cc.o</span><br><span class="line">[100%] Building CXX object sql/CMakeFiles/sql.dir/sql_audit.cc.o</span><br><span class="line">[100%] Building CXX object sql/CMakeFiles/sql.dir/sql_client.cc.o</span><br><span class="line">[100%] Building CXX object sql/CMakeFiles/sql.dir/srv_session.cc.o</span><br><span class="line">[100%] Building CXX object sql/CMakeFiles/sql.dir/srv_session_info_service.cc.o</span><br><span class="line">[100%] Building CXX object sql/CMakeFiles/sql.dir/srv_session_service.cc.o</span><br><span class="line">[100%] Building CXX object sql/CMakeFiles/sql.dir/auth/sha2_password_common.cc.o</span><br><span class="line">[100%] Building CXX object sql/CMakeFiles/sql.dir/mysqld_daemon.cc.o</span><br><span class="line">[100%] Linking CXX static library ../archive_output_directory/libsql.a</span><br><span class="line">[100%] Built target sql</span><br><span class="line">Scanning dependencies of target mysqld</span><br><span class="line">Scanning dependencies of target pfs_connect_attr-t</span><br><span class="line">[100%] Building CXX object sql/CMakeFiles/mysqld.dir/main.cc.o</span><br><span class="line">[100%] Building CXX object storage/perfschema/unittest/CMakeFiles/pfs_connect_attr-t.dir/pfs_connect_attr-t.cc.o</span><br><span class="line">[100%] Building CXX object storage/perfschema/unittest/CMakeFiles/pfs_connect_attr-t.dir/__/__/__/sql/sql_builtin.cc.o</span><br><span class="line">[100%] Building C object storage/perfschema/unittest/CMakeFiles/pfs_connect_attr-t.dir/__/__/__/mysys/string.c.o</span><br><span class="line">[100%] Linking CXX executable mysqld</span><br><span class="line">[100%] Linking CXX executable pfs_connect_attr-t</span><br><span class="line">[100%] Built target mysqld</span><br><span class="line">[100%] Built target pfs_connect_attr-t</span><br><span class="line">[root@ecs-kp01 mysql-5.7.27]<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>编译成功！</p>
<p>5、运行 make install，等待安装过程结束 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure>

<h2 id="四、配置-MySQL"><a href="#四、配置-MySQL" class="headerlink" title="四、配置 MySQL"></a>四、配置 MySQL</h2><p>1、创建”mysql”用户及用户组</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd mysql</span><br><span class="line">useradd -g mysql mysql</span><br></pre></td></tr></table></figure>
<p>2、修改”/usr/local/mysql”权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R mysql:mysql /usr/local/mysql</span><br></pre></td></tr></table></figure>
<p>3、进入安装路径，创建”data”、”log”、”run”文件夹，执行初始化配置脚本，生成初始的数据库和表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/mysql</span><br><span class="line">mkdir -p /data/log /data/data /data/run</span><br><span class="line">bin/mysqld --initialize --basedir=/usr/local/mysql --datadir=/data/data --user=mysql</span><br></pre></td></tr></table></figure>
<p><strong>需要指出的是，执行下述命令后，会产生初始随机密码，需要记录：</strong><br>2020-03-05T16:13:46.157168Z 1 [Note] A temporary password is generated for root@localhost: ?/tons2qtn+H</p>
<p>4、创建”mysql.log”和”mysql.pid”文件，赋予其”mysql”用户及用户组权限</p>
<p>其中，创建的“mysql.log”和“mysql.pid”文件是空文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">touch /data/log/mysql.log</span><br><span class="line">touch /data/run/mysql.pid</span><br><span class="line">chown -R mysql:mysql /data</span><br></pre></td></tr></table></figure>
<p>5、修改”my.cnf”中的文件路径，如图 1-1 所示</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">datadir=/data/data</span><br><span class="line">socket=/data/data/mysql.sock</span><br><span class="line"><span class="meta">#</span><span class="bash"> Disabling symbolic-links is recommended to prevent assorted security risks</span></span><br><span class="line">symbolic-links=0</span><br><span class="line"><span class="meta">#</span><span class="bash"> Settings user and group are ignored when systemd is used.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you need to run mysqld under a different user or group,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> customize your systemd unit file <span class="keyword">for</span> mariadb according to the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> instructions <span class="keyword">in</span> http://fedoraproject.org/wiki/Systemd</span></span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line">log-error=/data/log/mysql.log</span><br><span class="line">pid-file=/data/run/mysql.pid</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> include all files from the config directory</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line">!includedir /etc/my.cnf.d</span><br></pre></td></tr></table></figure>

<h2 id="五、运行-MySQL"><a href="#五、运行-MySQL" class="headerlink" title="五、运行 MySQL"></a>五、运行 MySQL</h2><p>1、启动或关闭MySQL服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cp support-files/mysql.server /etc/init.d/mysql</span><br><span class="line">chkconfig mysql on</span><br><span class="line">service mysql start</span><br><span class="line">成功启动如下所示：</span><br><span class="line">[root@ecs-test mysql]# service mysql start</span><br><span class="line">Starting MySQL.                                            [  OK  ]</span><br></pre></td></tr></table></figure>

<p>关闭数据库如下所示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost mysql]# service mysql stop</span><br><span class="line">Shutting down MySQL. SUCCESS!</span><br></pre></td></tr></table></figure>

<p>或者使用CentOS7的命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-kp01 etc]<span class="comment"># systemctl stop mysql.service</span></span><br><span class="line">[root@ecs-kp01 etc]<span class="comment"># systemctl start mysql.service</span></span><br><span class="line">[root@ecs-kp01 etc]<span class="comment"># systemctl status mysql.service</span></span><br><span class="line">● mysql.service - LSB: start and stop MySQL</span><br><span class="line">   Loaded: loaded (/etc/rc.d/init.d/mysql; bad; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Fri 2020-03-06 22:47:12 CST; 4s ago</span><br><span class="line">     Docs: man:systemd-sysv-generator(8)</span><br><span class="line">  Process: 10677 ExecStop=/etc/rc.d/init.d/mysql stop (code=exited, status=0/SUCCESS)</span><br><span class="line">  Process: 10755 ExecStart=/etc/rc.d/init.d/mysql start (code=exited, status=0/SUCCESS)</span><br><span class="line">   CGroup: /system.slice/mysql.service</span><br><span class="line">           ├─10764 /bin/sh /usr/<span class="built_in">local</span>/mysql/bin/mysqld_safe --datadir=/data/data --pid-file=/data/data/localhost.localdomain.pid</span><br><span class="line">           └─10919 /usr/<span class="built_in">local</span>/mysql/bin/mysqld --basedir=/usr/<span class="built_in">local</span>/mysql --datadir=/data/data --plugin-dir=/usr/<span class="built_in">local</span>/mysql/lib/plugin --user=mysql --<span class="built_in">log</span>-error=/da...</span><br><span class="line"></span><br><span class="line">Mar 06 22:47:11 localhost.localdomain systemd[1]: Starting LSB: start and stop MySQL...</span><br><span class="line">Mar 06 22:47:12 localhost.localdomain mysql[10755]: Starting MySQL. SUCCESS!</span><br><span class="line">Mar 06 22:47:12 localhost.localdomain systemd[1]: Started LSB: start and stop MySQL.</span><br></pre></td></tr></table></figure>

<p>2、将以下内容添加进环境变量，并使之生效</p>
<p>编辑文件并添加内容。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile</span><br></pre></td></tr></table></figure>
<p>添加的内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=/usr/local/mysql/bin:$PATH</span><br></pre></td></tr></table></figure>

<p>使环境变量生效</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure>

<p>3、建立套接字软链接，接入 MySQL 环境</p>
<p>需要输入的密码为配置 MySQL 时产生的初始密码，请留意初始密码包含了特殊字符。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s /data/data/mysql.sock /tmp/mysql.sock</span><br><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure>
<p>登录成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-test mysql]# ln -s &#x2F;data&#x2F;data&#x2F;mysql.sock &#x2F;tmp&#x2F;mysql.sock</span><br><span class="line">[root@ecs-test mysql]# mysql -u root -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 2</span><br><span class="line">Server version: 5.7.29</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2020, Oracle and&#x2F;or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure>

<p>4、修改密码<br>下述命令中的“123456”需要根据实际修改成要配置的密码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SET PASSWORD &#x3D; PASSWORD(&#39;123456&#39;);</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line">mysql&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>5、使用新的密码重新登录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-test mysql]# mysql -u root -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 3</span><br><span class="line">Server version: 5.7.29 Source distribution</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2020, Oracle and&#x2F;or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="六、MYSQL允许远程连接"><a href="#六、MYSQL允许远程连接" class="headerlink" title="六、MYSQL允许远程连接"></a>六、MYSQL允许远程连接</h2><p>在数据库中修改远程登录主机信息，使新安装的MYSQL可以远程登录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 修改权限 (注意这里用户名和密码替换成自己的)</span><br><span class="line">mysql&gt; GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39; WITH GRANT OPTION;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line">&#x2F;&#x2F;更新缓存</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">如果你是RPMp安装的数据库，找到&#x2F;etc&#x2F;my.cnf下面这一行，注释掉</span><br><span class="line">Change line</span><br><span class="line">bind-address &#x3D; 127.0.0.1</span><br><span class="line">to</span><br><span class="line">#bind-address &#x3D; 127.0.0.1</span><br><span class="line">重新启动服务：</span><br><span class="line">service mysql restart</span><br></pre></td></tr></table></figure>

<p>如果还不可以访问，要关掉数据库服务器的防火墙，或者配置允许3306端口出去。</p>
<h2 id="七、忘记MYSQL密码"><a href="#七、忘记MYSQL密码" class="headerlink" title="七、忘记MYSQL密码"></a>七、忘记MYSQL密码</h2><p>用以下命令启动MySQL，以不检查权限的方式启动，然后重新设置密码，重新登录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">service mysql stop</span><br><span class="line">service mysql start --skip-grant-tables</span><br><span class="line">mysql</span><br><span class="line"><span class="comment"># update修改密码</span></span><br><span class="line">mysql&gt; UPDATE mysql.user SET authentication_string=PASSWORD(<span class="string">'password'</span>) <span class="built_in">where</span> USER=<span class="string">'root'</span>;</span><br><span class="line">mysql&gt; flush privileges;//刷新权限</span><br><span class="line">mysql&gt; <span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<p>有密码的情况下修改密码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs mysql]# mysql -uroot -p</span><br><span class="line">Enter password:    &#x2F;&#x2F;直接按回车键</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 2</span><br><span class="line">Server version: 5.7.28 Source distribution</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2019, Oracle and&#x2F;or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its affiliates. Other names may be trademarks of their respective owners.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; UPDATE mysql.user SET authentication_string&#x3D;PASSWORD(&#39;password&#39;) where USER&#x3D;&#39;root&#39;;</span><br><span class="line">mysql&gt; flush privileges;&#x2F;&#x2F;刷新权限</span><br><span class="line">mysql&gt; exit</span><br><span class="line"></span><br><span class="line"># 登录测试</span><br><span class="line">[root@ecs mysql]# mysql -uroot -p</span><br><span class="line">Enter password: &#x2F;&#x2F;此处输入设置的密码</span><br><span class="line"></span><br><span class="line"># 说明：</span><br><span class="line">UPDATE mysql.user SET authentication_string&#x3D;PASSWORD(&#39;123456&#39;) where USER&#x3D;&#39;root&#39;; </span><br><span class="line"># 在此处更改密码，123456设置为实际要配置的密码</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://majunbo.top/20200506/kunpeng02-mysql5/" data-id="ckadmsiyw0000399x4t429ubu" class="article-share-link">分享到</a>
      

      

      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kunpeng/" rel="tag">kunpeng</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-kunpeng01-gcc" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20200505/kunpeng01-gcc/" class="article-date">
  <time datetime="2020-05-05T12:55:49.000Z" itemprop="datePublished">2020-05-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20200505/kunpeng01-gcc/">鲲鹏服务器实验一：GCC编译安装</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>华为官网已经有了相关的教材和资料，可参考：<a href="https://www.huaweicloud.com/kunpeng/software/gcc.html" target="_blank" rel="noopener">https://www.huaweicloud.com/kunpeng/software/gcc.html</a></p>
</blockquote>
<p>国内第三方GCC的帮助网站：<a href="http://c.biancheng.net/gcc/" target="_blank" rel="noopener">http://c.biancheng.net/gcc/</a></p>
<h2 id="一、安装一台华为鲲鹏服务器"><a href="#一、安装一台华为鲲鹏服务器" class="headerlink" title="一、安装一台华为鲲鹏服务器"></a>一、安装一台华为鲲鹏服务器</h2><p>在北京四、上海一、广州地区购买，其他地区没有鲲鹏服务器（截至2020年4月），可购买CentOS 7。</p>
<h2 id="二、检查当前系统GCC版本"><a href="#二、检查当前系统GCC版本" class="headerlink" title="二、检查当前系统GCC版本"></a>二、检查当前系统GCC版本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc --version</span><br></pre></td></tr></table></figure>

<h2 id="三、安装高版本GCC"><a href="#三、安装高版本GCC" class="headerlink" title="三、安装高版本GCC"></a>三、安装高版本GCC</h2><p>GCC官网：<a href="https://gcc.gnu.org/" target="_blank" rel="noopener">https://gcc.gnu.org/</a><br>GCC 7.5 released [2019-11-14]<br><a href="http://ftp.tsukuba.wide.ad.jp/software/gcc/releases/gcc-7.5.0/gcc-7.5.0.tar.gz" target="_blank" rel="noopener">http://ftp.tsukuba.wide.ad.jp/software/gcc/releases/gcc-7.5.0/gcc-7.5.0.tar.gz</a><br>GCC 8.4 released [2020-03-04]<br><a href="http://ftp.tsukuba.wide.ad.jp/software/gcc/releases/gcc-8.4.0/gcc-8.4.0.tar.gz" target="_blank" rel="noopener">http://ftp.tsukuba.wide.ad.jp/software/gcc/releases/gcc-8.4.0/gcc-8.4.0.tar.gz</a></p>
<p>1、安装依赖包（压缩解压缩程序）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y bzip2 wget</span><br><span class="line">yum install gcc gcc-c++</span><br></pre></td></tr></table></figure>

<p>2、下载 gcc-7.3.0 至/opt 目录下并解压<br>本文以7.3为例子：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt</span><br><span class="line">wget http://ftp.tsukuba.wide.ad.jp/software/gcc/releases/gcc-7.3.0/gcc-7.3.0.tar.gz</span><br><span class="line">tar -zxvf gcc-7.3.0.tar.gz</span><br></pre></td></tr></table></figure>

<p>3、将 gcc 的依赖包拷贝至”gcc-7.3.0”目录下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gcc-7.3需要这些文件：</span></span><br><span class="line">wget https://gcc.gnu.org/pub/gcc/infrastructure/gmp-6.1.0.tar.bz2</span><br><span class="line">wget https://gcc.gnu.org/pub/gcc/infrastructure/isl-0.16.1.tar.bz2</span><br><span class="line">wget https://gcc.gnu.org/pub/gcc/infrastructure/mpc-1.0.3.tar.gz</span><br><span class="line">wget https://gcc.gnu.org/pub/gcc/infrastructure/mpfr-3.1.4.tar.bz2</span><br><span class="line"></span><br><span class="line"><span class="comment"># gcc-8.4需要这些文件：</span></span><br><span class="line">wget https://gcc.gnu.org/pub/gcc/infrastructure/gmp-6.1.0.tar.bz2</span><br><span class="line">wget https://gcc.gnu.org/pub/gcc/infrastructure/isl-0.18.tar.bz2</span><br><span class="line">wget https://gcc.gnu.org/pub/gcc/infrastructure/mpc-1.0.3.tar.gz</span><br><span class="line">wget https://gcc.gnu.org/pub/gcc/infrastructure/mpfr-3.1.4.tar.bz2</span><br></pre></td></tr></table></figure>

<p>4、 进入”gcc-7.3.0”目录，对依赖进行检查</p>
<p>首先把上面下载的以来文件拷贝”gcc-7.3.0”目录下，再执行download_prerequisites：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> gcc-7.3.0</span><br><span class="line"><span class="comment"># 拷贝依赖包到gcc-7.3.0</span></span><br></pre></td></tr></table></figure>

<p>依赖检查结果如下所示，则依赖正确：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-kp01 gcc-7.3.0]<span class="comment"># ./contrib/download_prerequisites</span></span><br><span class="line">gmp-6.1.0.tar.bz2: OK</span><br><span class="line">mpfr-3.1.4.tar.bz2: OK</span><br><span class="line">mpc-1.0.3.tar.gz: OK</span><br><span class="line">isl-0.16.1.tar.bz2: OK</span><br><span class="line">All prerequisites downloaded successfully.</span><br></pre></td></tr></table></figure>

<p>5、编译安装 gcc</p>
<p>执行编译：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mkdir gcc-build-7.3.0</span><br><span class="line"><span class="built_in">cd</span> gcc-build-7.3.0</span><br><span class="line"></span><br><span class="line">../configure --<span class="built_in">enable</span>-checking=release --<span class="built_in">enable</span>-language=c,c++ \</span><br><span class="line">--<span class="built_in">disable</span>-multilib --prefix=/usr</span><br><span class="line"><span class="comment"># or 放到一行</span></span><br><span class="line">../configure --<span class="built_in">enable</span>-checking=release --<span class="built_in">enable</span>-language=c,c++ --<span class="built_in">disable</span>-multilib --prefix=/usr</span><br><span class="line"></span><br><span class="line">nohup make -j`cat /proc/cpuinfo| grep <span class="string">"processor"</span>| wc -l` &amp; //编译时间过长，放至后台执行</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者分批执行下列命令：</span></span><br><span class="line"><span class="comment"># 可通过下述命令查询 CPU 核数：</span></span><br><span class="line">[root@ecs-kp01 gcc-build-7.3.0]<span class="comment"># cat /proc/cpuinfo| grep "processor"| wc -l</span></span><br><span class="line">8</span><br><span class="line">[root@ecs-kp01 gcc-build-7.3.0]<span class="comment"># make -j8</span></span><br><span class="line"><span class="comment"># "-j"参数可利用多核 CPU 加快编译速度。</span></span><br><span class="line"><span class="comment"># 要求不同的CPU数量进行编译：4、8、16、等，8核CPU大概会在30分钟内编译完成</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：OS-7-aarch64-Minimal的安装，编译会出错：</strong><br>我的实验除了huaweicloud官网做了测试，也在华为泰山服务器做了实验，发现以下问题：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">rand/randsd.o rand/randsdui.o rand/randbui.o rand/randmui.o</span><br><span class="line">libtool: link: ranlib .libs/libgmp.a</span><br><span class="line">libtool: link: rm -fr .libs/libgmp.lax</span><br><span class="line">libtool: link: ( <span class="built_in">cd</span> <span class="string">".libs"</span> &amp;&amp; rm -f <span class="string">"libgmp.la"</span> &amp;&amp; ln -s <span class="string">"../libgmp.la"</span> <span class="string">"libgmp.la"</span> )</span><br><span class="line">make[5]: Leaving directory `/opt/gcc/gcc-7.3.0/gcc-build-7.3.0/gmp<span class="string">'</span></span><br><span class="line"><span class="string">make[4]: Leaving directory `/opt/gcc/gcc-7.3.0/gcc-build-7.3.0/gmp'</span></span><br><span class="line">make[3]: Leaving directory `/opt/gcc/gcc-7.3.0/gcc-build-7.3.0/gmp<span class="string">'</span></span><br><span class="line"><span class="string">make[2]: Leaving directory `/opt/gcc/gcc-7.3.0/gcc-build-7.3.0'</span></span><br><span class="line">make[1]: *** [stage1-bubble] Error 2</span><br><span class="line">make[1]: Leaving directory `/opt/gcc/gcc-7.3.0/gcc-build-7.3.0<span class="string">'</span></span><br><span class="line"><span class="string">make: *** [all] Error 2</span></span><br><span class="line"><span class="string">[root@localhost gcc-build-7.3.0]# </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 再执行，还是出错：</span></span><br><span class="line"><span class="string">config.status: linking ../../gmp/mpn/generic/add_n_sub_n.c to mpn/add_n_sub_n.c</span></span><br><span class="line"><span class="string">config.status: linking ../../gmp/mpn/generic/gmp-mparam.h to gmp-mparam.h</span></span><br><span class="line"><span class="string">config.status: executing libtool commands</span></span><br><span class="line"><span class="string">configure: summary of build options:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Version:           GNU MP 6.1.0</span></span><br><span class="line"><span class="string">  Host type:         none-unknown-linux-gnu</span></span><br><span class="line"><span class="string">  ABI:               standard</span></span><br><span class="line"><span class="string">  Install prefix:    /usr</span></span><br><span class="line"><span class="string">  Compiler:          gcc -std=gnu99</span></span><br><span class="line"><span class="string">  Static libraries:  yes</span></span><br><span class="line"><span class="string">  Shared libraries:  no</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">make[2]: Leaving directory `/opt/gcc/gcc-7.3.0/gcc-build-7.3.0'</span></span><br><span class="line">make[1]: *** [stage1-bubble] Error 2</span><br><span class="line">make[1]: Leaving directory `/opt/gcc/gcc-7.3.0/gcc-build-7.3.0<span class="string">'</span></span><br><span class="line"><span class="string">make: *** [all] Error 2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 最后解决方案：</span></span><br><span class="line"><span class="string">Installing gcc-c++ fixes it.</span></span><br><span class="line"><span class="string">ubuntu：apt-get install gcc g++</span></span><br><span class="line"><span class="string">CentOS：yum -y install gcc gcc-c++</span></span><br></pre></td></tr></table></figure>

<p>编译成功后执行安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ecs-kp01 gcc-build-7.3.0]<span class="comment"># make install</span></span><br></pre></td></tr></table></figure>

<h2 id="四、安装完成"><a href="#四、安装完成" class="headerlink" title="四、安装完成"></a>四、安装完成</h2><p>查看安装的版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 7.3版本查看</span></span><br><span class="line">[root@ecs-kp01 gcc-build-7.3.0]<span class="comment"># gcc -v </span></span><br><span class="line">Using built-in specs.</span><br><span class="line">COLLECT_GCC=gcc</span><br><span class="line">COLLECT_LTO_WRAPPER=/usr/libexec/gcc/aarch64-unknown-linux-gnu/7.3.0/lto-wrapper</span><br><span class="line">Target: aarch64-unknown-linux-gnu</span><br><span class="line">Configured with: ../configure --<span class="built_in">enable</span>-checking=release --<span class="built_in">enable</span>-language=c,c++ --<span class="built_in">disable</span>-multilib --prefix=/usr</span><br><span class="line">Thread model: posix</span><br><span class="line">gcc version 7.3.0 (GCC) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.5版本查看</span></span><br><span class="line">[root@ecs-web gcc-build-7.5.0]<span class="comment"># gcc --version</span></span><br><span class="line">gcc (GCC) 7.5.0</span><br><span class="line">Copyright (C) 2017 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the <span class="built_in">source</span> <span class="keyword">for</span> copying conditions.  There is NO</span><br><span class="line">warranty; not even <span class="keyword">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></table></figure>

<p>编译安装成功!</p>
<blockquote>
<p>附录：git 编译安装：<br><a href="https://blog.csdn.net/networken/article/details/85403969" target="_blank" rel="noopener">https://blog.csdn.net/networken/article/details/85403969</a></p>
</blockquote>
<h2 id="五、GCC制作为RPM包"><a href="#五、GCC制作为RPM包" class="headerlink" title="五、GCC制作为RPM包"></a>五、GCC制作为RPM包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">安装制作工具</span><br><span class="line">[root@web ~]<span class="comment"># yum install rpmdevtools rpm-build wget gcc gcc-c++</span></span><br><span class="line">[root@web ~]<span class="comment"># yum wget gcc gcc-c++</span></span><br><span class="line">[root@web ~]<span class="comment"># mkdir rpmbuild</span></span><br><span class="line">[root@web ~]<span class="comment"># cd /root/rpmbuild/</span></span><br><span class="line"></span><br><span class="line">[root@web rpmbuild]<span class="comment"># rpmdev-setuptree</span></span><br><span class="line">[root@web rpmbuild]<span class="comment"># cd SOURCES</span></span><br><span class="line">[root@web SOURCES]<span class="comment"># wget http://ftp.tsukuba.wide.ad.jp/software/gcc/releases/gcc-8.4.0/gcc-8.4.0.tar.gz</span></span><br><span class="line">or</span><br><span class="line">[root@web SOURCES]<span class="comment"># wget https://kunpengsoft.obs.cn-north-4.myhuaweicloud.com/gcc-7.3.tar.gz</span></span><br><span class="line">[root@web SOURCES]<span class="comment"># cd /root/rpmbuild/SPECS</span></span><br><span class="line">[root@web SPECS]<span class="comment"># vim gcc.spec</span></span><br><span class="line"></span><br><span class="line">编译：</span><br><span class="line">[root@web SPECS]<span class="comment"># QA_RPATHS=0x0020 rpmbuild -bb gcc.spec</span></span><br><span class="line">QA_RPATHS=0x0020 rpmbuild -bb gcc.spec</span><br><span class="line">or</span><br><span class="line">[root@web SPECS]<span class="comment"># rpmbuild -bb gcc.spec</span></span><br></pre></td></tr></table></figure>

<p>制作RPM包（for gcc）<br><a href="https://blog.csdn.net/weixin_39660205/article/details/89473205" target="_blank" rel="noopener">https://blog.csdn.net/weixin_39660205/article/details/89473205</a><br><a href="https://www.codeleading.com/article/2949852757/" target="_blank" rel="noopener">https://www.codeleading.com/article/2949852757/</a></p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://majunbo.top/20200505/kunpeng01-gcc/" data-id="ckadkr1mc00042v9x8bra6xml" class="article-share-link">分享到</a>
      

      

      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kunpeng/" rel="tag">kunpeng</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hexo-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/20200405/hexo-install/" class="article-date">
  <time datetime="2020-04-05T11:53:45.000Z" itemprop="datePublished">2020-04-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/20200405/hexo-install/">用Hexo框架搭建静态博客</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一、Hexo简介"><a href="#一、Hexo简介" class="headerlink" title="一、Hexo简介"></a>一、Hexo简介</h2><p>【Hexo 静态博客框架】是一个纯静态的博客网站框架，也就是一款基于 Node.js 的静态博客框架，依赖少、易于安装使用，可以方便的生成静态网页托管在服务器上，并且Hexo 使用 <code>Markdown</code>（或其他渲染引擎）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。</p>
<p>你访问的这个博客就是使用<a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a>来搭建的，因为<code>Markdown</code>写博客太太太方便了 ^_^。</p>
<p>产生写博客想法以来，开始准备域名、备案、主机购买、技术选型，经历了将近一个月。经过自己的实验发现Hexo是最适合我的，除了有<code>Markdown</code>以外，还因为它是生成的静态页面，这样用户访问速度也是最快的。</p>
<blockquote>
<p>任何动态语言网站的访问速度都没有HTML快！对不？</p>
</blockquote>
<h2 id="二、中文教程"><a href="#二、中文教程" class="headerlink" title="二、中文教程"></a>二、中文教程</h2><p>Hexo编写博客可以放到个人虚拟主机上，也可以放到github。<br>目前这个网站是<a href="https://majunbo.top/">majunbo.top</a>，放到了华为云主机，<br>同步在<a href="https://majunbo.github.io/" target="_blank" rel="noopener">majunbo.github.io</a>，也有一份一模一样的网站。</p>
<p>这套软件官网：<br><a href="https://hexo.io/zh-cn/index.html" target="_blank" rel="noopener">https://hexo.io/zh-cn/index.html</a></p>
<p>并且网已经有了比较不错的教程：</p>
<p>教程1：<br><a href="https://zhuanlan.zhihu.com/p/26625249" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/26625249</a></p>
<p>教程2：<br><a href="https://zhuanlan.zhihu.com/p/136160884" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/136160884</a><br><a href="https://zhuanlan.zhihu.com/p/136160884" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/136160884</a></p>
<p>后续有时间，我也可能也会放一些简单的操作步骤。</p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="https://majunbo.top/20200405/hexo-install/" data-id="ckadkr1m900022v9x1a0t83ip" class="article-share-link">分享到</a>
      

      

      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页 &gt;</a>
  </nav>
</section>
      
      <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/" rel="tag">Hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kunpeng/" rel="tag">kunpeng</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%9F%A5%E8%AF%86%E5%85%B1%E4%BA%AB/" rel="tag">知识共享</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">近期文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/20200513/kunpeng09-nginx-install/">鲲鹏服务器实验九：编译nginx</a>
          </li>
        
          <li>
            <a href="/20200512/kunpeng08-nodejscms/">鲲鹏服务器实验八：部署Node.js系统</a>
          </li>
        
          <li>
            <a href="/20200511/kunpeng07-pythoncms/">鲲鹏服务器实验七：部署Python语言系统</a>
          </li>
        
          <li>
            <a href="/20200510/kunpeng06-javacms/">鲲鹏服务器实验六：部署Java语言CMS</a>
          </li>
        
          <li>
            <a href="/20200509/kunpeng05-phpcms/">鲲鹏服务器实验五：部署PHP语言CMS</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://arvinxiang.com" target="_blank">主题作者</a>
          </li>
        
          <li>
            <a href="http://reqianduan.com" target="_blank">热前端</a>
          </li>
        
          <li>
            <a href="http://yuancheng.work" target="_blank">远程.work</a>
          </li>
        
          <li>
            <a href="https://ljf.com/about/" target="_blank">卢敬锋，Medis作者荐</a>
          </li>
        
          <li>
            <a href="https://www.v2ex.com/member/luin" target="_blank">石墨文档技术总监</a>
          </li>
        
          <li>
            <a href="https://1024.com/" target="_blank">1024只猴子</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 鲲鹏小哪吒   
      <a href="http://beian.miit.gov.cn/" target="_blank" class="beian-icp"
       rel="nofollow noopener">豫ICP备20009777</a>
      <br>
      Powered by <a href="//hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->


<!-- 百度分享 start -->

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<! -- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
                processEscapes: true
                    
}
  
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
                  
}
    
        });
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Queue(function() {
            var all = MathJax.Hub.getAllJax(), i;
            for(i=0; i < all.length; i += 1) {
                            all[i].SourceElement().parentNode.className += ' has-jax';
                                    
            }
                
        });
</script>

<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



<script src="/js/script.js"></script>


</div>
</body>
</html>
